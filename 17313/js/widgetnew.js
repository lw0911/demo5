var jquery_code=$().jquery;function BHide(id){var Div=document.getElementById(id);if(Div)Div.style.display="none"}function BShow(id){var Div=document.getElementById(id);if(Div)Div.style.display="block"}function BGet(id){if(document.getElementById(id))return document.getElementById(id)}function addHandler(target,type,func){var btn=document.getElementById(target);if(btn)if(btn.addEventListener)btn.addEventListener(type,func,false);else if(btn.attachEvent)btn.attachEvent("on"+type,func);else btn["on"+type]=func}function CurrPosition(btn,div){var button=BGet(btn),popdiv=BGet(div);if(button&&popdiv){var L1=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),T1=Math.max(document.documentElement.scrollTop,document.body.scrollTop),L2=button.getBoundingClientRect().left,T2=button.getBoundingClientRect().top,L3=button.clientWidth,T3=button.clientHeight,L=parseInt(L1)+parseInt(L2)+1+"px",T=parseInt(T1)+parseInt(T2)+parseInt(T3)-2+"px";popdiv.style.display="block";popdiv.style.position="absolute";popdiv.style.left=L;popdiv.style.top=T}$(popdiv).bgiframe()}function getPositonL(id){var btn=document.getElementById(id);if(btn){var L1=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),L2=btn.getBoundingClientRect().left,L3=btn.clientWidth,L=parseInt(L1)+parseInt(L2)+parseInt(L3);return L}}function getPositonT(id){var btn=document.getElementById(id);if(btn){var T1=Math.max(document.documentElement.scrollTop,document.body.scrollTop),T2=btn.getBoundingClientRect().top,T3=btn.clientHeight,T=parseInt(T1)+parseInt(T2)+parseInt(T3);return T}}function BtPopload(showId){var h=Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)+"px",w=document.documentElement.scrollWidth+"px",exsit=document.getElementById("popBox");if(!exsit){pop_Box=document.createElement("div");pop_Box.id="popBox";document.getElementsByTagName("body")[0].appendChild(pop_Box)}var pop_Box=document.getElementById("popBox");pop_Box.className="dialog-mask";pop_Box.style.zIndex="99";pop_Box.style.height=h;pop_Box.style.width=w;$("#popBox").bgiframe();BShow("popBox");BShow(showId);pop_Win=document.getElementById(showId);pop_Win.style.position="absolute";pop_Win.style.zIndex="125";pop_Win.style.left=document.documentElement.clientWidth/2-pop_Win.offsetWidth/2+"px";if(navigator.userAgent.indexOf("Safari")>0||navigator.userAgent.indexOf("Chrome")>0)pop_Win.style.top=document.body.scrollTop+document.documentElement.clientHeight/2-pop_Win.offsetHeight/2+"px";else pop_Win.style.top=document.documentElement.scrollTop+document.documentElement.clientHeight/2-pop_Win.offsetHeight/2+"px"}function BtUnload(showId){BHide("popIframe");BHide("popBox");BHide(showId)}function BtTabRemove(index,head,divs){var tab_heads=document.getElementById(head);if(tab_heads){for(var as=tab_heads.getElementsByTagName("a"),i=0;i<as.length;i++){as[i].className="";BHide(divs+"_"+i);if(i==index)as[i].className="current"}setTimeout(function(){BShow(divs+"_"+index)},100)}}function BtTabOn(head,divs){var tab_heads=document.getElementById(head);if(tab_heads){BtTabRemove(0,head,divs);for(var alis=tab_heads.getElementsByTagName("a"),i=0;i<alis.length;i++){alis[i].num=i;alis[i].onclick=function(){BtTabRemove(this.num,head,divs);this.blur();return false};alis[i].onfocus=function(){BtTabRemove(this.num,head,divs)}}}}function BtZebraStrips(id,tag){var ListId=document.getElementById(id);if(ListId)for(var tags=ListId.getElementsByTagName(tag),i=0;i<tags.length;i++){tags[i].className+=" barry"+i%2;tags[i].onmouseover=function(){this.className+=" hover"};tags[i].onmouseout=function(){this.className=this.className.replace(" hover","")}}}function BasSelect(idOrOptions,vid,divBefore,typeValue,data,TitleName,isCheckAll,LeftNum,MaxNum,isSelect,position,iframeId,cid,cvid,onClosed){var id;if(typeof idOrOptions=="object"){var options=idOrOptions;id=options.id;vid=options.vid;divBefore=options.divBefore;typeValue=options.typeValue;data=options.data;TitleName=options.titleName;isCheckAll=options.isCheckAll;LeftNum=options.leftNum;MaxNum=options.maxNum;isSelect=options.isSelect;position=options.position;iframeId=options.iframeId;cid=options.cid;cvid=options.cvid;onClosed=options.onClosed}else id=idOrOptions;if(typeof data=="string")$.jsonpGet("ConstDataUrl",{constCode:data},function(result){eval(result);data=eval(data);_BasSelect()});else _BasSelect();function _BasSelect(){LeftNum=LeftNum||1e4;typeValue=(typeValue||"").toLowerCase()=="radio"?"radio":"checkbox";function _doOnClosedFunc(ok){onClosed!=null&&onClosed(ok)}BGet(id).setAttribute("readonly","true");BGet(id).blur();var Bdid=divBefore+"_com_select",liId=divBefore+"_P",iframeId=iframeId||"",cid=cid||"",cvid=cvid||"";function getCity(){var strs=[];_getCity(data,strs);return strs.join("")}function _getCity(nodes,strs){var dataClass="",abc="";switch(data[0][1]){case"安徽":dataClass="Ajson";break;case"计算机硬件及网络设备":dataClass="Ijson";abc="IjsonUl";break;case"销售类":dataClass="Jjson";break;case"哲学类":dataClass="Mjson"}strs.push('<ul class="'+abc+'">');for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i],value=node[0],text=node[1],subNodes=node[2],hasSubNodes=subNodes==null||subNodes=="undefined"||subNodes.length<=0||subNodes[0][0].length==6;if(hasSubNodes)hasSubNodes=false;else hasSubNodes=true;var selected=dataEd.indexOf(","+value+",")>=0,shortText=text.substring(0,LeftNum/1);strs.push('<li class="');strs.push(dataClass);strs.push('"><input name=');strs.push(divBefore);strs.push('_Itmes type="');strs.push(typeValue);strs.push('" id="');strs.push(liId);strs.push(value);strs.push('" lang="');strs.push(value);strs.push('" value="');strs.push(shortText);strs.push('" ');strs.push(selected?"checked":"");strs.push(" />");strs.push('<label for="');strs.push(liId);strs.push(value);strs.push('" class="');strs.push(hasSubNodes?"have":"");strs.push('" ');strs.push(shortText==text?"":' title="'+text+'"');strs.push(">");strs.push(shortText);strs.push("</label>");hasSubNodes&&_getCity(subNodes,strs);strs.push("</li>")}strs.push("</ul>")}function getSelect(){for(var ctr=" ",i=0,l=data.length;i<l;i++){var node=data[i],value=node[0],text=node[1];if(value==""){ctr+="<option value='"+value+"'";if(isCheckAll==value)ctr+=" selected = 'selected'";ctr+=">"+text+"</option>"}}return ctr}function getValue(d1,v1,v2){var div=document.getElementById(d1),va1=document.getElementById(v1),va2=document.getElementById(v2);if(div&&va1&&va2){var sps=div.getElementsByTagName("span"),txt="",ids="";for(i=0;i<sps.length;i++){txt+=sps[i].innerHTML+",";ids+=sps[i].lang+","}va1.value=txt.substr(0,txt.length-1);va2.value=ids.substr(0,ids.length-1);if(iframeId!=""&&iframeId.length>0){$("#"+iframeId).contents().find("#"+cid).val(txt.substr(0,txt.length-1));$("#"+iframeId).contents().find("#"+cvid).val(ids.substr(0,ids.length-1))}}}var obj=divBefore+"_allItems",dataEd=","+BGet(vid).value+",";function _buildSelectItemHtml(arr,s){for(var i=0,l=arr.length;i<l;i++){var item=arr[i],code=item[0],text=item[1],children=item[2];dataEd.indexOf(","+code+",")>-1&&s.push("<span lang="+code+">"+text.substring(0,LeftNum/1)+"</span>");children!=null&&_buildSelectItemHtml(children,s)}}var SelectedItem=[];_buildSelectItemHtml(data,SelectedItem);SelectedItem=SelectedItem.join("");var dstr="";if(typeValue=="radio")dstr=" style='display:none'";var Title=TitleName,ClId=divBefore+"_close",CmId=divBefore+"_confirm",CuId=divBefore+"_cleanup",CtId=divBefore+"_count",SlId=divBefore+"_selectedUl",UlId=divBefore+"_list",SeId=divBefore+"_select";function _getVidLen(){var s=$("#"+vid).val();return s==null||s==0?0:s.split(",").length}var vidLen=_getVidLen(),strs=[];strs.push("<div class='com_select selectdialog' id='"+Bdid+"'><table class='bs_pop' id='bs_pop'><tr><td class='tl'></td><td class='tc dialog-header'>");strs.push("<div>");strs.push("<h2 class='dialog-title'>"+Title+"</h2>");strs.push("<span id="+ClId+" class='dialog-close'>关闭</span>");strs.push("</div></td><td class='tr'></td></tr><tr><td class='ll'></td><td>");strs.push("<div class='com_select-content bs_pop_content'>");strs.push("<div class='de_btns'>");isSelect==1&&strs.push("<select id="+SeId+">"+getSelect()+"</select>");strs.push("</div>");strs.push("<ul id='"+UlId+"'>");strs.push(getCity());strs.push("</ul>");strs.push("<div class='de_selected'"+dstr+">已选择:<em id="+CtId+">"+vidLen+"</em>个</div>");strs.push("<div id='"+SlId+"' class='com_selectedUl'"+dstr+">");strs.push(SelectedItem);strs.push("</div><div class=clear></div></div>");strs.push("<div class='pop_btns'>");if(typeValue=="radio")strs.push("<input type='reset' name='clearBtn' value='清空' class='submit inabled' />");else{strs.push("<input type='reset' id='"+CmId+"' value='确认' class='submit inabled'"+dstr+" />");strs.push("<input type='reset' id='"+CuId+"' value='取消' class='submit inabled'"+dstr+" />")}strs.push("</div></td><td class='lr'></td></tr><tr><td class='bl'></td><td class='bc'></td><td class='br'></td></tr></table>");strs.push("</div>");var str=strs.join("");pop_Box=document.createElement("div");pop_Box.id=Bdid;document.getElementsByTagName("body")[0].appendChild(pop_Box);var exsit=BGet(Bdid);exsit.innerHTML=str;addHandler(ClId,"click",function(){BtUnload(Bdid);_doOnClosedFunc(false)});var Pro=BGet(UlId),StedId=BGet(SlId),Cnum=BGet(CtId),SelectId=BGet(SeId);if(SelectId)SelectId.onchange=function(){Pro.innerHTML=getCity(this.value)};$(Pro).bind("mouseenter",function(){var pro=$(this);pro.unbind("mouseenter");var lis=pro.find("li");lis.bind("mouseenter",function(){$(this).addClass("hover")}).bind("mouseleave",function(){$(this).removeClass("hover")});var ins=pro.find("input");function _changed(element,state){var e=$(element),s=0;if(jquery_code=="1.6")s=e.attr("checked");else s=e.attr("checked");var state=state==null?s:state;if(state){var sps=StedId.getElementsByTagName("span");if(typeValue!=="radio")if(sps.length>MaxNum/1-1){e.attr("checked",false);alert("最多只能选择"+MaxNum+"项!");return false}if(typeValue=="radio"){StedId.innerHTML="<span lang="+e.attr("lang")+">"+e.attr("value")+"</span>";getValue(SlId,id,vid);BtUnload(Bdid);_doOnClosedFunc(true)}else{StedId.innerHTML+="<span lang="+e.attr("lang")+">"+e.attr("value")+"</span>";Cnum.innerHTML=$(StedId).find("span").length;_selectSubCheckBoxes(e,true)}}else{var html=StedId.innerHTML.toLowerCase().replace(/"([^"]*)"/g,"$1");StedId.innerHTML=html.replace("<span lang="+e.attr("lang")+">"+e.attr("value").toLowerCase()+"</span>","");Cnum.innerHTML=$(StedId).find("span").length;_selectSubCheckBoxes(e,false)}return true}$(ins).bind("click",function(){_changed($(this))});function _selectSubCheckBoxes(e,state){var checkBoxes=e.parents("li:first").children("ul").children("li").find("input");checkBoxes.each(function(){var cb=$(this),state0=cb.attr("checked",state);if(state)cb.attr("checked",true).attr("disabled",true);else cb.attr("checked",false).attr("disabled",false);_changed(cb,false)})}});var cbtn=BGet(CuId);if(cbtn)cbtn.onclick=function(){StedId.innerHTML="";BGet(CtId).innerHTML="0";$(Pro).find("input").each(function(){$(this).attr("checked",false).attr("disabled",false)});BtUnload(Bdid);_doOnClosedFunc(false)};$("input[name=clearBtn]").click(function(){$(".bs_pop input[type=radio][checked]").attr("checked","");$("input#"+id).val("");$("input#"+vid).val("");BtUnload(Bdid)});StedId.onmouseover=function(){var sps=StedId.getElementsByTagName("span");for(i=0;i<sps.length;i++)sps[i].onclick=function(){BGet(CtId).innerHTML-=1;var obj=document.getElementById(liId+this.lang);if(obj)if(jquery_code=="1.6")$(obj).prop("checked",false).parents("li:first").find("input").attr("disabled",false).prop("checked",false);else $(obj).attr("checked",false).parents("li:first").find("input").attr("disabled",false).attr("checked",false);StedId.removeChild(this)}};var CmBn=BGet(CmId);if(CmBn)CmBn.onclick=function(){getValue(SlId,id,vid);BtUnload(Bdid);_doOnClosedFunc(true)};if(typeof position=="object"){BtPopload(Bdid);position.left!=null&&$("#A_com_select").css("left",position.left);position.top!=null&&$("#A_com_select").css("top",position.top)}else if(position/1==0)CurrPosition(id,Bdid);else BtPopload(Bdid)}}function BasSelect_getTextsByCodes(data,codes){if(codes==null)return"";if(typeof codes=="number")codes=[codes.toString()];for(var texts=[],codes=typeof codes=="string"?codes.split(","):codes,k=0,l=codes.length;k<l;k++){var code=codes[k].replace(/^\s+|\s+$/g,"");if(code.length==0)continue;var text=_getTextByCode(data,code);texts.push(text==null?"":text)}return texts;function _getTextByCode(d,c){for(var k=0,len=d.length;k<len;k++){var node=d[k],code=node[0],text=node[1],subNodes=node[2];if(code==c)return text;if(subNodes!=null){var t=_getTextByCode(subNodes,c);if(t!=null)return t}}return null}}(function($){$.fn.bgiframe=$.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(s){s=$.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},s);var html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"style="display:block;position:absolute;z-index:-1;'+(s.opacity!==false?"filter:Alpha(Opacity='0');":"")+"top:"+(s.top=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":prop(s.top))+";left:"+(s.left=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":prop(s.left))+";width:"+(s.width=="auto"?"expression(this.parentNode.offsetWidth+'px')":prop(s.width))+";height:"+(s.height=="auto"?"expression(this.parentNode.offsetHeight+'px')":prop(s.height))+';"/>';return this.each(function(){$(this).children("iframe.bgiframe").length===0&&this.insertBefore(document.createElement(html),this.firstChild)})}:function(){return this};$.fn.bgIframe=$.fn.bgiframe;function prop(n){return n&&n.constructor===Number?n+"px":n}})(jQuery);(function($){var cachedata={},arrweebox=[],weebox=function(content,options){var self=this;this.dh=null;this.mh=null;this.dc=null;this.dt=null;this.db=null;this.icon=null;this.selector=null;this.ajaxurl=null;this.options=null;this._dragging=false;this._content=content||"";this._options=options||{};this._defaults={boxid:null,boxclass:null,cache:false,type:"dialog",model:"",title:"",icon:"",left:null,top:null,width:0,height:0,timeout:0,draggable:true,modal:true,focus:null,blur:null,position:"center",overlay:30,showTitle:true,showButton:true,showCancel:true,showOk:true,okBtnName:"确定",cancelBtnName:"取消",contentType:"text",contentChange:false,clickClose:false,zIndex:2e3,animate:"",showAnimate:"",hideAnimate:"",onclose:null,onopen:null,oncancel:null,onok:null,id:"niframe",suggest:{url:"",tele:"",vele:"",fn:null},select:{url:"",type:"radio",tele:"",vele:"",width:120,search:false,fn:null}};var timeObj;this.initOptions=function(){self._options=self._options||{};self._options.animate=self._options.animate||"";self._options.showAnimate=self._options.showAnimate||self._options.animate;self._options.hideAnimate=self._options.hideAnimate||self._options.animate;self._options.type=self._options.type||"dialog";self._options.title=self._options.title||"";self._options.boxclass=self._options.boxclass||"wee"+self._options.type;self._options.contentType=self._options.contentType||"";if(self._options.contentType=="")self._options.contentType=self._content.substr(0,1)=="#"?"selector":"text";self.options=$.extend({},self._defaults,self._options);self._options=null;self._defaults=null};this.initBox=function(){var html="";switch(self.options.type){case"alert":case"select":case"dialog":html='<div class="weedialog">\t<table class="bs_pop" id="bs_pop"><tr><td class="tl"></td><td class="tc dialog-header"><div class="">\t\t\t<div class="dialog-tc2">\t\t\t<h2 class="dialog-title"></h2> \t\t\t<span title="关闭" class="bs_pop_close dialog-close">关闭</span>\t\t\t<span class="bs_pop_max" title="最大化">最大化</span>\t\t\t<span class="bs_pop_min" title="最小化">最小化</span>\t\t\t</div>\t</div></td><td class="tr"></td></tr><tr><td class="ll"></td><td>\t\t\t\t<div class="bs_pop_content dialog-content"></div>\t\t\t\t<div class="dialog-button pop_btns">\t\t\t\t\t<input type="button" class="submit inabled dialog-ok" value="确定">\t\t\t\t\t<input type="button" class="submit inabled dialog-cancel" value="取消">\t\t\t\t</div></td><td class="lr"></td></tr><tr><td class="bl"></td><td class="bc"></td><td class="br"></td></tr></table></div>';break;case"dialog-OK":case"dialog-Error":case"dialog-Question":case"dialog-Remind":case"dialog-Warning":html='<div class="weedialog">\t<table class="bs_pop" id="bs_pop"><tr><td class="tl"></td><td class="tc dialog-header"><div class="">\t\t\t<div class="dialog-tc2">\t\t\t<h2 class="dialog-title"></h2> \t\t\t<span title="关闭" class="bs_pop_close dialog-close">关闭</span>\t\t\t<span class="bs_pop_max" title="最大化">最大化</span>\t\t\t<span class="bs_pop_min" title="最小化">最小化</span>\t\t\t</div>\t</div></td><td class="tr"></td></tr><tr><td class="ll"></td><td class="dialogTD">   <div class="dialog-icon '+self.options.type+'"></div>\t\t\t\t<div class="bs_pop_content dialog-content bs_dialog"></div>\t\t\t\t<div class="dialog-button pop_btns">\t\t\t\t\t<input type="button" class="submit inabled dialog-ok" value="确定">\t\t\t\t\t<input type="button" class="submit inabled dialog-cancel" value="取消">\t\t\t\t</div></td><td class="lr"></td></tr><tr><td class="bl"></td><td class="bc"></td><td class="br"></td></tr></table></div>';break;case"custom":case"suggest":html='<div><div class="dialog-content"></div></div>';break;case"notify":html='<div class="weenotify">  <table class="bs_pop" id="bs_pop" style="100%">     <tr><td class="weenotify_border weenotify_border_topleft"></td><td class="weenotify_border weenotify_border_top"></td><td class="weenotify_border weenotify_border_topright"><span title="关闭" class="dialog-close weenotify_close"></span></td></tr>    <tr><td class="weenotify_border weenotify_border_left"></td><td class="weenotify_content"><span class="weenotify_icon" style="display:block;"></span><span class="weenotify_content dialog-content"></span></td><td class="weenotify_border weenotify_border_right"></td></tr>    <tr><td class="weenotify_border weenotify_border_bottomleft"></td><td class="weenotify_border weenotify_border_bottom"></td><td class="weenotify_border weenotify_border_bottomright"></td></tr>  </table></div>'}self.dh=$(html).appendTo("body").hide().css({position:"absolute",overflow:"hidden",zIndex:self.options.zIndex});self.dc=self.find(".dialog-content");self.dt=self.find(".dialog-title");self.db=self.find(".dialog-button");self.di=self.find(".dialog-icon");self.options.boxid&&self.dh.attr("id",self.options.boxid);self.options.boxclass&&self.dh.addClass(self.options.boxclass);switch(self.options.model){case"tiny":self.options.width=343;self.options.height=105;break;case"mini":self.options.width=553;self.options.height=125;break;case"normal":self.options.width=673;self.options.height=281;break;case"middle":self.options.width=678;self.options.height=435;break;case"large":self.options.width=858;self.options.height=380}if(self.options.type=="dialog-OK"||self.options.type=="dialog-Warning"||self.options.type=="dialog-Error"||self.options.type=="dialog-Question"||self.options.type=="dialog-warning"||self.options.type=="dialog-Remind"){self.options.width=553;self.options.height=102}self.options.height>0&&self.dc.css("height",self.options.height);self.options.width>0&&self.dh.css("width",self.options.width);self.dh.bgiframe()};this.initMask=function(){if(self.options.modal)self.mh=$("<div class='dialog-mask'></div>").appendTo("body").hide().css({width:self.bwidth(),height:self.bheight(),zIndex:self.options.zIndex-1}).bgiframe()};this.initContent=function(){self.dh.find(".dialog-ok").val(self.options.okBtnName);self.dh.find(".dialog-cancel").val(self.options.cancelBtnName);self.options.title!=""&&self.dt.html(self.options.title);!self.options.showTitle&&self.dh.find(".dialog-header").hide();!self.options.showButton&&self.dh.find(".dialog-button").hide();!self.options.showCancel&&self.dh.find(".dialog-cancel").hide();!self.options.showOk&&self.dh.find(".dialog-ok").hide();if(self.options.type=="suggest"){self.hide();$(self.options.suggest.tele).unbind("keyup").keyup(function(){var val=$.trim(this.value),data=null;for(key in cachedata)if(key==val)data=cachedata[key];data===null&&$.ajax({type:"GET",data:{q:val},url:self.options.suggest.url||self._content,success:function(res){data=res},dataType:"json",async:false});cachedata[val]=data;var html="";for(key in data)html+="<li>"+data[key].name+"</li>";self.setContent(html);self.show();self.find("li").click(function(){var i=self.find("li").index(this);$(self.options.suggest.tele).val(data[i].name);$(self.options.suggest.vele).val(data[i].id);typeof self.options.suggest.fn=="function"&&fn(data[i]);self.hide()})})}else if(self.options.type=="select"){var type=self.options.select.type||"radio",url=self.options.select.url||self._content||"",search=self.options.select.search||false;$.ajax({type:"GET",url:url,success:function(data){var html="";if(data===null)html="没有数据";else{if(search)html+='<div class="wsearch"><input type="text"><input type="button" value="查询"></div>';var ovals=$.trim($(self.options.select.vele).val()).split(",");html+='<div class="wselect">';for(key in data){var checked=$.inArray(data[key].id,ovals)==-1?"":'checked="checked"';html+='<li><label><input name="wchoose" '+checked+' type="'+type+'" value="'+data[key].id+'">'+data[key].name+"</label></li>"}html+="</div>"}self.setContent(html);self.find("li").width(self.options.select.width);self.find(".wsearch input").keyup(function(){var v=$.trim(this.value);self.find("li").hide();for(i in data)(data[i].id==v||data[i].name.indexOf(v)!=-1)&&self.find("li:eq("+i+")").show()});self.setOnok(function(){if(type=="radio")if(self.find(":checked").length==0){$(self.options.select.tele).val("");$(self.options.select.vele).val("")}else{var i=self.find(":radio[name=wchoose]").index(self.find(":checked")[0]);$(self.options.select.tele).val(data[i].name);$(self.options.select.vele).val(data[i].id);typeof self.options.select.fn=="function"&&fn(data[i])}else if(self.find(":checked").length==0){$(self.options.select.tele).val("");$(self.options.select.vele).val("")}else{var temps=[],ids=[],names=[];self.find(":checked").each(function(){var i=self.find(":checkbox[name=wchoose]").index(this);temps.push(data[i]);ids.push(data[i].id);names.push(data[i].name)});$(self.options.select.tele).val(names.join(","));$(self.options.select.vele).val(ids.join(","));typeof self.options.select.fn=="function"&&fn(temps)}self.close()});self.show()},dataType:"json"})}else if(self.options.contentType=="selector"){self.selector=self._content;self._content=$(self.selector).html();self.setContent(self._content);var cs=$(self.selector).find(":checkbox");self.dc.find(":checkbox").each(function(i){this.checked=cs[i].checked});$(self.selector).empty();self.show();self.focus();self.onopen()}else if(self.options.contentType=="ajax"){self.ajaxurl=self._content;self.setLoading();self.show();self.dh.find(".dialog-button").hide();if(self.options.cache==false)if(self.ajaxurl.indexOf("?")==-1)self.ajaxurl+="?_t="+Math.random();else self.ajaxurl+="&_t="+Math.random();$.get(self.ajaxurl,function(data){self._content=data;self.setContent(self._content);self.show();self.focus();self.onopen()})}else if(self.options.contentType=="iframe"){self.iframeurl=self._content;var h=self.options.height;self.setContent("<iframe style='width:100%;height:"+h+"px;' src='"+self.iframeurl+"' frameborder='0' name='"+self.options.id+"' id='"+self.options.id+"'></iframe>");self.show();self.onopen();self.focus()}else if(self.options.type=="notify"){self.icon=self.find(".weenotify_icon");var icon=self.options.icon||"default";self.icon.addClass("weenotify_icon_"+icon);self.setContent(self._content);self.show();self.focus();self.onopen()}else if(self.options.type=="dialog-OK"){self.setContent(self._content);self.show();self.focus();self.onopen()}else{self.setContent(self._content);self.show();self.focus();self.onopen()}};this.initEvent=function(){self.dh.find(".dialog-close, .dialog-cancel, .dialog-ok").unbind("click").click(function(){self.close()});typeof self.options.onok=="function"&&self.dh.find(".dialog-ok").unbind("click").click(function(){self.options.onok(self)});typeof self.options.oncancel=="function"&&self.dh.find(".dialog-cancel").unbind("click").click(function(){self.options.oncancel(self)});if(self.options.timeout>0)timeObj=window.setTimeout(self.close,self.options.timeout*1e3);this.drag()};this.setOnok=function(fn){self.dh.find(".dialog-ok").unbind("click");typeof fn=="function"&&self.dh.find(".dialog-ok").click(function(){fn(self)})};this.setOncancel=function(fn){self.dh.find(".dialog-cancel").unbind("click");typeof fn=="function"&&self.dh.find(".dialog-cancel").click(function(){fn(self)})};this.setOnclose=function(fn){self.options.onclose=fn};this.drag=function(){self.options.draggable&&self.options.showTitle&&self.dh.find(".dialog-header").mousedown(function(event){var h=this,o=document,ox=self.dh.position().left,oy=self.dh.position().top,mx=event.clientX,my=event.clientY,width=self.dh.width(),height=self.dh.height(),bwidth=self.bwidth(),bheight=self.bheight();h.setCapture&&h.setCapture();$(document).mousemove(function(event){if(window.getSelection)window.getSelection().removeAllRanges();else document.selection.empty();var left=Math.max(ox+event.clientX-mx,0),top=Math.max(oy+event.clientY-my,0);if($.browser.msie&&$.browser.version!=8)var left=Math.min(left,bwidth-width),top=Math.min(top,bheight-height);self.dh.css({left:left,top:top})}).mouseup(function(){h.releaseCapture&&h.releaseCapture();$(document).unbind("mousemove");$(document).unbind("mouseup")})})};this.onopen=function(){if(typeof self.options.onopen=="function")self.options.onopen(self)};this.addButton=function(opt){opt=opt||{};opt.title=opt.title||"OK";opt.bclass=opt.bclass||"dialog-btn1";opt.fn=opt.fn||null;opt.index=opt.index||0;var btn=$('<input type="button" class="'+opt.bclass+'" value="'+opt.title+'">').click(function(){typeof opt.fn=="function"&&opt.fn(self)});if(opt.index<self.db.find("input").length)self.db.find("input:eq("+opt.index+")").before(btn);else self.db.append(opt)};this.show=function(){self.options.showButton&&self.dh.find(".dialog-button").show();if(self.options.position=="center")self.setCenterPosition();else self.setElementPosition();if(typeof self.options.showAnimate=="string")self.dh.show(self.options.animate);else self.dh.animate(self.options.showAnimate.animate,self.options.showAnimate.speed);self.mh&&self.mh.show()};this.hide=function(fn){if(typeof self.options.hideAnimate=="string")self.dh.hide(self.options.animate,fn);else self.dh.animate(self.options.hideAnimate.animate,self.options.hideAnimate.speed,"",fn)};this.focus=function(){if(self.options.focus)self.dh.find(self.options.focus).focus();else self.dh.find(".dialog-cancel").focus()};this.find=function(selector){return self.dh.find(selector)};this.setLoading=function(){self.setContent('<div class="dialog-loading"></div>');self.dh.find(".dialog-button").hide();self.dc.height()<90&&self.dc.height(Math.max(90,self.options.height));self.dh.width()<200&&self.dh.width(Math.max(200,self.options.width))};this.setWidth=function(width){self.dh.width(width)};this.setTitle=function(title){self.dt.html(title)};this.getTitle=function(){return self.dt.html()};this.setContent=function(content){self.dc.html(content);if(self.options.height>0)self.dc.css("height",self.options.height);else self.dc.css("height","");if(self.options.width>0)self.dh.css("width",self.options.width);else self.dh.css("width","");self.options.showButton&&self.dh.find(".dialog-button").show()};this.getContent=function(){return self.dc.html()};this.disabledButton=function(btname,state){self.dh.find(".dialog-"+btname).attr("disabled",state)};this.hideButton=function(btname){self.dh.find(".dialog-"+btname).hide()};this.showButton=function(btname){self.dh.find(".dialog-"+btname).show()};this.setButtonTitle=function(btname,title){self.dh.find(".dialog-"+btname).val(title)};this.next=function(opt){opt=opt||{};opt.title=opt.title||self.getTitle();opt.content=opt.content||"";opt.okname=opt.okname||"确定";opt.width=opt.width||260;opt.onok=opt.onok||self.close;opt.onclose=opt.onclose||null;opt.oncancel=opt.oncancel||null;opt.hideCancel=opt.hideCancel||true;self.setTitle(opt.title);self.setButtonTitle("ok",okname);self.setWidth(width);self.setOnok(opt.onok);opt.content!=""&&self.setContent(opt.content);opt.hideCancel&&self.hideButton("cancel");typeof opt.onclose=="function"&&self.setOnclose(opt.onclose);typeof opt.oncancel=="function"&&self.setOncancel(opt.oncancel);self.show()};this.close=function(){if(typeof self.options.onclose=="function")self.options.onclose(self);if(self.options.contentType=="selector")if(self.options.contentChange){var cs=self.find(":checkbox");$(self.selector).html(self.getContent());cs.length>0&&$(self.selector).find(":checkbox").each(function(i){this.checked=cs[i].checked})}else $(self.selector).html(self._content);self.options.blur&&$(self.options.blur).focus();for(i=0;i<arrweebox.length;i++)if(arrweebox[i].dh.get(0)==self.dh.get(0)){arrweebox.splice(i,1);break}self.hide();self.dh.remove();self.mh&&self.mh.remove();timeObj&&clearTimeout(timeObj)};this.bheight=function(){if($.browser.msie&&$.browser.version<7){var scrollHeight=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),offsetHeight=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return scrollHeight<offsetHeight?$(window).height():scrollHeight}else return $.browser.msie&&$.browser.version==8?document.documentElement.clientHeight:$(document).height()};this.bwidth=function(){if($.browser.msie&&$.browser.version<7){var scrollWidth=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return scrollWidth<offsetWidth?$(window).width():scrollWidth}else return $(document).width()};this.setCenterPosition=function(){var wnd=$(window),doc=$(document),pTop=doc.scrollTop(),pLeft=doc.scrollLeft();pTop+=(wnd.height()-self.dh.height())/2;pLeft+=(wnd.width()-self.dh.width())/2;if(pTop<0)pTop=0;self.dh.css({top:pTop,left:pLeft})};this.setElementPosition=function(){var trigger=$(self.options.position.refele),reftop=self.options.position.reftop||0,refleft=self.options.position.refleft||0,adjust=typeof self.options.position.adjust=="undefined"?true:self.options.position.adjust,top=trigger.offset().top+trigger.height(),left=trigger.offset().left,docWidth=document.documentElement.clientWidth||document.body.clientWidth,docHeight=document.documentElement.clientHeight||document.body.clientHeight,docTop=document.documentElement.scrollTop||document.body.scrollTop,docLeft=document.documentElement.scrollLeft||document.body.scrollLeft,docBottom=docTop+docHeight,docRight=docLeft+docWidth;if(adjust&&left+self.dh.width()>docRight)left=docRight-self.dh.width()-1;if(adjust&&top+self.dh.height()>docBottom)top=docBottom-self.dh.height()-1;left=Math.max(left+refleft,0);top=Math.max(top+reftop,0);self.dh.css({top:top,left:left})};this.initOptions();this.initMask();this.initBox();this.initContent();this.initEvent()},weeboxs=function(){var self=this;this._onbox=false;this._opening=false;this.zIndex=2e3;this.length=function(){return arrweebox.length};this.open=function(content,options){self._opening=true;if(typeof options=="undefined")options={};if(options.boxid)for(var i=0;i<arrweebox.length;i++)if(arrweebox[i].dh.attr("id")==options.boxid){arrweebox[i].close();break}options.zIndex=self.zIndex;self.zIndex+=10;var box=new weebox(content,options);box.dh.click(function(){self._onbox=true});arrweebox.push(box);return box};this.notify=function(content,icon,timeout,onclose){return this.open(content,{type:"notify",timeout:timeout||0,title:"",icon:icon,draggable:false,animate:true,onclose:onclose,showAnimate:{animate:{opacity:"show"},speed:"normal"},hideAnimate:{animate:{opacity:"hide"},speed:"normal"}})};this.getTopBox=function(){return arrweebox.length>0?arrweebox[arrweebox.length-1]:false};$(window).scroll(function(){if(arrweebox.length>0)for(i=0;i<arrweebox.length;i++){var box=arrweebox[i];box.options.position!="center"&&box.setElementPosition();box.mh&&box.mh.css({width:box.bwidth(),height:box.bheight()})}}).resize(function(){if(arrweebox.length>0){var box=self.getTopBox();box.options.position=="center"&&box.setCenterPosition();box.mh&&box.mh.css({width:box.bwidth(),height:box.bheight()})}});$(document).click(function(event){if(event.button==2)return true;if(arrweebox.length>0){var box=self.getTopBox();!self._opening&&!self._onbox&&box.options.clickClose&&box.close()}self._opening=false;self._onbox=false})};$.extend({weeboxs:new weeboxs})})(jQuery);if($.browser.msie)if($.browser.version=="6.0"){$(".pop_btns input.submit").mouseover(function(){$(this).addClass("hover")}).mouseout(function(){$(this).removeClass("hover")});$(".pop_btns input.inabled").mouseover(function(){$(this).addClass("hover")}).mouseout(function(){$(this).removeClass("hover")})}$.fn.weeBoxClose=function(){$(".dialog-mask",window.parent.document).hide();$(".weedialog",window.parent.document).hide();$(".dialog-mask").hide();$(".weedialog").hide()};jQuery(function(){if($.fn.superfish){$(".menu2").superfish();$.browser.msie&&$.browser.version==6&&$("ul.menu2").find("ul").bgIframe({opacity:false})}});(function(win){var store={},doc=win.document,localStorageName="localStorage",scriptTag="script",storage;store.disabled=false;store.set=function(){};store.get=function(){};store.remove=function(){};store.clear=function(){};store.transact=function(key,defaultVal,transactionFn){var val=store.get(key);if(transactionFn==null){transactionFn=defaultVal;defaultVal=null}if(typeof val=="undefined")val=defaultVal||{};transactionFn(val);store.set(key,val)};store.getAll=function(){};store.forEach=function(){};store.serialize=function(value){return JSON.stringify(value)};store.deserialize=function(value){if(typeof value!="string")return undefined;try{return JSON.parse(value)}catch(e){return value||undefined}};store.withExp={"set":function(key,val,exp){store.set(key,{val:val,exp:exp,time:(new Date).getTime()})},"get":function(key){var info=store.get(key);return!info?null:(new Date).getTime()-info.time>info.exp?null:info.val}};function isLocalStorageNameSupported(){try{return localStorageName in win&&win[localStorageName]}catch(err){return false}}if(isLocalStorageNameSupported()){storage=win[localStorageName];store.set=function(key,val){if(val===undefined)return store.remove(key);storage.setItem(key,store.serialize(val));return val};store.get=function(key){return store.deserialize(storage.getItem(key))};store.remove=function(key){storage.removeItem(key)};store.clear=function(){storage.clear()};store.getAll=function(){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.forEach=function(callback){for(var i=0;i<storage.length;i++){var key=storage.key(i);callback(key,store.get(key))}}}else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile");storageContainer.open();storageContainer.write("<"+scriptTag+">document.w=window</"+scriptTag+'><iframe src="/favicon.ico"></iframe>');storageContainer.close();storageOwner=storageContainer.w.frames[0].document;storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div");storageOwner=doc.body}function withIEStorage(storeFunction){return function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(storage);storageOwner.appendChild(storage);storage.addBehavior("#default#userData");storage.load(localStorageName);var result=storeFunction.apply(store,args);storageOwner.removeChild(storage);return result}}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function ieKeyFix(key){return key.replace(/^d/,"___$&").replace(forbiddenCharsRegex,"___")}store.set=withIEStorage(function(storage,key,val){key=ieKeyFix(key);if(val===undefined)return store.remove(key);storage.setAttribute(key,store.serialize(val));storage.save(localStorageName);return val});store.get=withIEStorage(function(storage,key){key=ieKeyFix(key);return store.deserialize(storage.getAttribute(key))});store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key);storage.removeAttribute(key);storage.save(localStorageName)});store.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++)storage.removeAttribute(attr.name);storage.save(localStorageName)});store.getAll=function(){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.forEach=withIEStorage(function(storage,callback){for(var attributes=storage.XMLDocument.documentElement.attributes,i=0,attr;attr=attributes[i];++i)callback(attr.name,store.deserialize(storage.getAttribute(attr.name)))})}try{var testKey="__storejs__";store.set(testKey,testKey);if(store.get(testKey)!=testKey)store.disabled=true;store.remove(testKey)}catch(e){store.disabled=true}store.enabled=!store.disabled;win._basStore=store})(Function("return this")());!function($,global){var pathHelper=function(){function PH(){}PH.prototype={typeConf:{areaChina:[4,6],areaForeign:[3,5,7]},areaChina:function(tid){var reslt=[],func=function(arr,id){arr.push(id);return id.length==6?func(arr,id.substring(0,4)):id.substring(id.length-2)!=="00"?func(arr,id.substring(0,2)+"00"):arr};return func(reslt,tid).reverse()},areaForeign:function(tid){var reslt=[],func=function(arr,id){var len=id.length;arr.push(id);len>3&&func(arr,id.substring(0,len-2));return arr};return func(reslt,tid).reverse()},defaults:function(tModel){return _.map(tModel.get("path"),function(item){return item.id})},checkPath:function(type,tModel){var len=tModel.get("id").length;return!this.typeConf[type]?true:_.contains(this.typeConf[type],len)}};var ph=new PH;ph.constructor=PH;return ph}(),initDict="ABCDEFGHIJKLMNOPQRSTUVWXYZ",initSpliter=["E","J","O","T"];function BasSelect(settings){this.vHost=settings._valHost;this.tHost=settings._txtHost;this.isMulti=settings.type=="checkbox";this.title=settings.title,this.min=this.isMulti?settings.min:0,this.max=this.isMulti?settings.max:0,this.contentHeight=310;this.h={tabH:36,breadH:18,initH:21,sltedTH:24,sltedCH:this.isMulti?60:22,all:310};this.doc=$(global.document);this.map=settings.map;this.init()}$.extend(BasSelect.prototype,{init:function(){this.prChkState=false;this.$el=$(_.template(this.template.getWrap())(_.extend({},this.h,{title:this.title})));this.pathRef=[];this.getAreaData();this.pop();this.bindEvents()},ui:{chkbox:".lst_item input",unfoldBtn:".pr .uf",tabs:".bas_tab .inacti",breadcr:".breadcr_item a",delBtn:".items_selected .dlt",itemToHide:".h",grpItem:".init_grp_item.init_inacti",cttWrap:".bas_select_ctt",clear:".bas_btn_cl",btnSave:".bas_btn_save",btnCanc:".bas_btn_canc"},bindEvents:function(){this.$el.delegate(this.ui.chkbox,"click",_.bind(this.clickOne,this));this.$el.delegate(this.ui.unfoldBtn,"click",_.bind(this.showNextLevel,this));this.$el.delegate(this.ui.tabs,"click",_.bind(this.switchTab,this));this.$el.delegate(this.ui.breadcr,"click",_.bind(this.goToPath,this));this.$el.delegate(this.ui.delBtn,"click",_.bind(this.deleteOne,this));this.$el.delegate(this.ui.grpItem,"click",_.bind(this.swtichInitGroup,this));this.$el.delegate(this.ui.clear,"click",_.bind(this.clearAll,this));this.$el.delegate(this.ui.btnSave,"click",_.bind(this.saveData,this));this.$el.delegate(this.ui.btnCanc,"click",_.bind(this.closePop,this))},unbindEvent:function(){this.$el.unbind()},calcContentHeight:function(){this.$el.find(this.ui.itemToHide).hide();var cttWrap=this.$el.find(this.ui.cttWrap),_h=this.h,h=_h.all-(_h.tabH+_h.breadH)-(_h.sltedCH+_h.sltedTH)-(this.currentViewData.type=="bas_grp_by_init"?_h.initH:0);cttWrap.css("height",h+"px")},pop:function(){this.createMask();this.doc.find("body").append(this.$el)},clickOne:function(e){var self=this,node=$(e.currentTarget),st=node.is(":checked");if(st&&this.max&&this.selectedData.length>=this.max)return false;var finder={};finder[this.map.id]=node.val();var nodeData=_.findWhere(this.currentCttData,finder);this.updateOne(nodeData,st)},deleteOne:function(e){var idToDel=$(e.currentTarget).parent().attr("rel"),tmpl={};tmpl[this.map.id]=idToDel;this.updateOne(tmpl,false)},clearAll:function(){this.selectedData=[];this.$el.find(this.ui.chkbox).prop("checked",false);this.prChkState=false;_.each(this.pathRef,function(item){item.prChkState=false});this.showSelectedItemView();this.showContentListView()},updateOne:function(obj,st){st&&this.removeItemChildren(obj);var self=this,finder={};finder[this.map.id]=obj[this.map.id];if(st)if(this.isMulti)this.selectedData.push(_.extend(_.omit(obj,this.map.children),{path:this.getItemPath(finder[this.map.id])}));else this.selectedData=[_.extend(_.omit(obj,this.map.children),{path:this.getItemPath(finder[this.map.id])})];else{var modelToDel=_.findWhere(this.selectedData,finder);this.selectedData=_.reject(this.selectedData,function(item){return item[self.map.id]==finder[self.map.id]});this.updateContentWhenDel(modelToDel)}this.showSelectedItemView()},removeItemChildren:function(cModel){var self=this,modelToRemoved=[],cid=cModel[this.map.id];_.each(this.selectedData,function(tModel){var pathArr=pathHelper[self.currentViewData.pathType](tModel[self.map.id]);if(pathArr.length<=1)return;_.contains(pathArr,cid)&&modelToRemoved.push(tModel)});if(modelToRemoved.length>0)this.selectedData=_.reject(this.selectedData,function(item){return _.contains(modelToRemoved,item)})},getItemPath:function(id){var arr=this.getCurrentPath();arr.push(id);return arr},getCurrentPath:function(){var self=this,arr=_.map(this.pathRef,function(item){return item.piece[self.map.id]});return arr},updateContentWhenDel:function(model){var itemPath=pathHelper[this.currentViewData.pathType](model[this.map.id]),iL=itemPath.length,currentPath=this.getCurrentPath(),cL=currentPath.length;if(iL-cL>1)return;var crnt=_.last(currentPath);if(iL-cL===1){if(!crnt||_.contains(itemPath,crnt))return this.uncheckItem(model[this.map.id]);return}if(_.contains(currentPath,crnt))return this.enableCurrentPath(model[this.map.id])},uncheckItem:function(id){var self=this,tNode=this.$el.find(this.ui.chkbox).filter(function(){return $(this).val()==id});tNode.length&&tNode.prop("checked",false)},enableCurrentPath:function(id){var self=this,st=false;_.each(this.pathRef,function(item){if(item.piece[self.map.id]==id)st=true;if(st)item.prChkState=false});this.prChkState=false;this.showContentListView()},showNextLevel:function(e){var node=$(e.currentTarget).parent().find("input"),finder={},id=node.val();finder[this.map.id]=id;var model=_.findWhere(this.currentCttData,finder),currentRefData={data:this.currentCttData,state:this.prChkState,piece:{}};currentRefData.piece[this.map.id]=model[this.map.id];currentRefData.piece[this.map.text]=model[this.map.text];this.pathRef.push(currentRefData);this.prChkState=this.prChkState||node.is(":checked");this.currentCttData=model[this.map.children];this.showContentListView();this.updateBreadcr(model)},goToPath:function(e){var i=$(e.currentTarget).parent().index();this.breadcrData=this.breadcrData.slice(0,i+1);this.pathRef=this.pathRef.slice(0,i+1);var last=this.pathRef.pop();this.prChkState=last.state;this.currentCttData=last.data;this.showBreadcrumpView();this.showContentListView()},createMask:function(){this.mask=$(this.template.getMask());this.doc.find("body").append(this.mask)},getAreaData:function(){var key="NewAjson";this.checkData(key);if(global[key])return this.initContents(global[key]);var self=this;$.ajax({url:"http://const.tms.beisen.cn/Api/Defination/AreaFormat",cache:true,jsonpCallback:"constData"+key,dataType:"jsonp"}).done(function(data){var sData={flag:false,data:data};_basStore.withExp.set(key,sData,12*60*60*1e3);global[key]=data;self.initContents(global[key])})},checkData:function(key){var sData=_basStore.withExp.get(key);if(sData&&typeof sData==="object")global[key]=sData.data},initContents:function(data){this.prepareData(data);this.prepareRegions();this.showContents()},switchTab:function(e){var node=$(e.currentTarget),i=node.parent().index();_.findWhere(this.sourceData.sources,{active:true}).active=false;this.sourceData.sources[i].active=true;this.updateCurrentState();this.updateStateView()},prepareRegions:function(){this.rg=rg={};rg.tabs=this.$el.find(".bas_select_tabs");rg.initGrp=this.$el.find(".bas_select_init_grp");rg.breadcr=this.$el.find(".bas_select_breadcr");rg.ctt=this.$el.find(".bas_select_ctt");rg.slted=this.$el.find(".bas_select_slted")},showContents:function(){this.updateStateView()},updateStateView:function(){this.calcContentHeight();this.sourceData.isShowTab&&this.showTabsView();this.currentViewData.type==="bas_grp_by_init"&&this.showInitGroupView();this.showBreadcrumpView();this.showContentListView();this.showSelectedItemView()},showTabsView:function(){var compile=_.template(this.template.getTabs()),tabsView=compile({data:this.sourceData.sources});this.rg.tabs.html(tabsView).show()},showInitGroupView:function(){var compile=_.template(this.template.getInitGroup()),initGroupView=compile({data:this.currentViewData.data});this.rg.initGrp.html(initGroupView);this.rg.initGrp.show()},swtichInitGroup:function(e){var self=this,rel=$(e.currentTarget).attr("rel");_.each(this.currentViewData.data,function(item){var st=item.groupLetter==rel;item.active=st;if(st)self.currentCttData=item.data});this.breadcrData=[{name:this.currentViewData.rootName}];this.prChkState=false;this.updateStateView()},showBreadcrumpView:function(){var compile=_.template(this.template.getBreadcr()),breadcrView=compile({data:this.breadcrData});this.rg.breadcr.html(breadcrView)},updateBreadcr:function(model){this.breadcrData.push({name:model[this.map.text]});this.showBreadcrumpView()},showContentListView:function(){var compile=_.template(this.template.getCtt()),cttView=compile({data:this.currentCttData,map:this.map,state:this.prChkState,isMulti:this.isMulti});this.rg.ctt.html(cttView);this.setSelected()},setSelected:function(){var self=this,iptList=self.$el.find(this.ui.chkbox);_.each(this.selectedData,function(item){var ipt=iptList.filter(function(){return $(this).val()==item[self.map.id]});ipt.length&&ipt.prop("checked",true)})},showSelectedItemView:function(){var compile=_.template(this.template.getSelected()),seletedView=compile({data:this.selectedData,map:this.map,h:this.h,isMulti:this.isMulti,max:this.max});this.rg.slted.html(seletedView).show()},prepareData:function(data){var config={sources:[{type:"bas_category",tabName:"国内",rootName:"全部省份",active:true,pathType:"areaChina"},{type:"bas_grp_by_init",tabName:"国外",rootName:"国家",active:false,pathType:"areaForeign"}]};config.isShowTab=data.length>1;$.each(config.sources,function(index,item){if(!data[index])return;item.data=data[index].c});this.sourceData=config;this.updateCurrentState();this.selectedData=this.initSelectedData();this.updateGrpInitData(_.where(this.sourceData.sources,{type:"bas_grp_by_init"}))},initSelectedData:function(){var self=this,tData=this.tHost.val();if($.trim(tData)=="")return[];tData=tData.split(",");var vData=this.vHost.val().split(","),tmpArr=[];_.each(vData,function(item,i){var tmpObj={},v=item.split("-"),t=tData[i];tmpObj[self.map.id]=_.last(v);tmpObj.path=v;tmpObj[self.map.text]=t;tmpArr.push(tmpObj)});return tmpArr},updateCurrentState:function(){this.currentViewData=_.findWhere(this.sourceData.sources,{active:true});this.prChkState=false;this.currentCttData=this.currentViewData.data;this.breadcrData=[{name:this.currentViewData.rootName}];if(this.currentViewData.type=="bas_grp_by_init"){_.each(this.currentViewData.data,function(item,i){item.active=i==0});this.currentCttData=this.currentViewData.data[0].data}},updateGrpInitData:function(initData){var self=this;this.initialObj=this.getInitalArr();_.each(initData,function(item){if(item.arraged)return;self.rearrangeData(item)})},getInitalArr:function(){var obj={};_.each(initDict,function(item){obj[item]={initial:item,data:[]}});return obj},rearrangeData:function(initData){var self=this;_.each(initData.data,function(item){var initial=item.p.charAt(0);self.initialObj[initial.toUpperCase()].data.push(item)});this.groupArrangedData(initData)},groupArrangedData:function(initData){var data=this.initialObj,tmpObj=[],g=function(grp){var tmpa=[];if(!grp.length)reutn;_.each(grp,function(letter){tmpa=tmpa.concat(data[letter].data)});tmpObj.push({groupLetter:grp.join(""),data:tmpa,active:false})},dict=initDict.split("");_.each(initSpliter,function(spliter){var i=_.indexOf(dict,spliter),grp=dict.splice(0,i+1);g(grp)});g(dict);initData.data=tmpObj;initData.arraged=true},template:{getWrap:function(){return['<div class="bas_select_wrap">','<div class="bas_select_head"><%=title%></div>','<div class="bas_select_ctt_wrap" style="height:<%=all%>px">','<div class="bas_select_tabs h" style="height:<%=tabH%>px"></div>','<div class="bas_select_init_grp h" style="height:<%=initH%>px"></div>','<div class="bas_select_breadcr" style="height:<%=breadH%>px"></div>','<div class="bas_select_ctt" style=""></div>','<div class="bas_select_slted items_selected"</div>',"</div>",'<div class="bas_select_buttons">','<a href="javascript:void(0)" class="bas_btn_canc">取消</a>','<a href="javascript:void(0)" class="bas_btn_save">确定</a>',"</div>","</div>"].join("")},getInitGroup:function(){return['<ul class="cf">',"<% _.each(data, function(item){ %>",'<li class="init_grp_item<%=item.active?" init_acti":" init_inacti"%>" rel="<%=item.groupLetter%>"><%=item.groupLetter%></li>',"<% }) %>","</ul>"].join("")},getTabs:function(){return["<ul>","<% _.each(data, function(item){ %>",'<li class="bas_tab"><div class="<%=item.active? "acti" : "inacti"%>"><%=item.tabName%></div></li>',"<% }) %>","</ul>"].join("")},getBreadcr:function(){return['<ul class="cf">',"<% _.each(data, function(item,i){ %>",'<li class="breadcr_item">',"<% if(data.length-1 == i){ %>","<span><%=item.name%></span>","<% }else{ %>",'<a href="javascript:void(0)"><%=item.name%></a>',"<% } %>"," &gt; ","</li>","<% }) %>","</ul>"].join("")},getCtt:function(){return['<ul class="cf">',"<% _.each(data, function(item,i){ %>","<li>","<%var c = item[map.children]%>",'<div class="<%=c&&c.length ? "pr ":""%>lst_item">','<input type="<%=isMulti?"checkbox":"radio"%>" name="cateItems" value="<%=item[map.id]%>" ','<%=state&&isMulti? "disabled checked" : ""%>',"/> ",'<label title="<%=item[map.text]%>" class="txt_ellipsis uf"><%=item[map.text]%></label>','<span class="iconfont uf"></span>',"</div>","</li>","<% }) %>","</ul>"].join("")},getSelected:function(){return['<div style="height:<%=h.sltedTH%>px;"><span style="float:left;">已选 <%=data.length%><%=max ? "/" + max : ""%> 个</span><a class="bas_btn_cl" href="javascript:void(0)" style="<%=isMulti?"":"display:none;"%>float:right;margin-left:20px;">清空</a></div>','<ul style="overflow-y:auto; height:<%=h.sltedCH%>px;">',"<% _.each(data, function(item){ %>",'<li rel="<%=item[map.id]%>" class="s_item">','<span title="<%=item[map.text]%>"><%=item[map.text]%></span>','<span rel="4500" class="dlt iconfont">&#xe603;</span>',"</li>","<% }) %>","</ul>"].join("")},getMask:function(){return['<div class="bas_s_mask" style="',"position:fixed;","height:100%;","width:100%;","background: #000;","left:0;top:0;","opacity:0.5;","z-index:2;",'filter: progid:DXImageTransform.Microsoft.Alpha(opacity=50); -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(opacity=50)";','"></div>'].join("")}},saveData:function(){var self=this,o={val:[],txt:[]};_.each(this.selectedData,function(item){o.val.push(item[self.map.id]);o.txt.push(item[self.map.text])});this.tHost.val(o.txt);this.vHost.val(o.val);this.closePop()},closePop:function(){this.mask.remove();this.$el.remove();this.unbindEvent()}});$.fn.extend({basSelect:function(settings){var defaltuSettings={type:"checkbox",data:"NewAjson",title:"选择数据",min:0,max:0,_txtHost:$(this),_valHost:$(settings.valHost)};$.extend(defaltuSettings,settings);new BasSelect(defaltuSettings)}})}(jQuery,window.top)
