(function(){var d=document,w=window;function get(element){if(typeof element=="string")element=d.getElementById(element);return element}function addEvent(el,type,fn){if(w.addEventListener)el.addEventListener(type,fn,false);else if(w.attachEvent){var f=function(){fn.call(el,w.event)};el.attachEvent("on"+type,f)}}var toElement=function(){var div=d.createElement("div");return function(html){div.innerHTML=html;var el=div.childNodes[0];div.removeChild(el);return el}}();function hasClass(ele,cls){return ele.className.match(new RegExp("(\\s|^)"+cls+"(\\s|$)"))}function addClass(ele,cls){if(!hasClass(ele,cls))ele.className+=" "+cls}function removeClass(ele,cls){var reg=new RegExp("(\\s|^)"+cls+"(\\s|$)");ele.className=ele.className.replace(reg," ")}if(document.documentElement.getBoundingClientRect)var getOffset=function(el){var box=el.getBoundingClientRect(),doc=el.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,zoom=1;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}if(zoom>1){clientTop=0;clientLeft=0}var top=box.top/zoom+(window.pageYOffset||docElem&&docElem.scrollTop/zoom||body.scrollTop/zoom)-clientTop,left=box.left/zoom+(window.pageXOffset||docElem&&docElem.scrollLeft/zoom||body.scrollLeft/zoom)-clientLeft;return{top:top,left:left}};else var getOffset=function(el){if(w.jQuery)return jQuery(el).offset();var top=0,left=0;do{top+=el.offsetTop||0;left+=el.offsetLeft||0}while(el=el.offsetParent);return{left:left,top:top}};function getBox(el){var left,right,top,bottom,offset=getOffset(el);left=offset.left;top=offset.top;right=left+el.offsetWidth;bottom=top+el.offsetHeight;return{left:left,right:right,top:top,bottom:bottom}}function getMouseCoords(e){if(!e.pageX&&e.clientX){var zoom=1,body=document.body;if(body.getBoundingClientRect){var bound=body.getBoundingClientRect();zoom=(bound.right-bound.left)/body.clientWidth}return{x:e.clientX/zoom+d.body.scrollLeft+d.documentElement.scrollLeft,y:e.clientY/zoom+d.body.scrollTop+d.documentElement.scrollTop}}return{x:e.pageX,y:e.pageY}}var getUID=function(){var id=0;return function(){return"ValumsAjaxUpload"+id++}}();function fileFromPath(file){return file.replace(/.*(\/|\\)/,"")}function getExt(file){return/[.]/.exec(file)?/[^.]+$/.exec(file.toLowerCase()):""}Ajax_upload=AjaxUpload=function(button,options){if(button.jquery)button=button[0];else if(typeof button=="string"&&/^#.*/.test(button))button=button.slice(1);button=get(button);this._input=null;this._button=button;this._disabled=false;this._submitting=false;this._justClicked=false;this._parentDialog=d.body;if(window.jQuery&&jQuery.ui&&jQuery.ui.dialog){var parentDialog=jQuery(this._button).parents(".ui-dialog");if(parentDialog.length)this._parentDialog=parentDialog[0]}this._settings={action:"upload.php",name:"userfile",data:{},autoSubmit:true,responseType:false,onChange:function(){},onSubmit:function(){},onComplete:function(){},isJsonpRequest:false,onJsonpCallBack:function(){}};for(var i in options)this._settings[i]=options[i];this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(data){this._settings.data=data},disable:function(){this._disabled=true},enable:function(){this._disabled=false},destroy:function(){if(this._input){this._input.parentNode&&this._input.parentNode.removeChild(this._input);this._input=null}},_createInput:function(){var self=this,input=d.createElement("input");input.setAttribute("type","file");input.setAttribute("name",this._settings.name);var styles={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(var i in styles)input.style[i]=styles[i];if(!(input.style.opacity==="0"))input.style.filter="alpha(opacity=0)";this._parentDialog.appendChild(input);addEvent(input,"change",function(){var file=fileFromPath(this.value);if(self._settings.onChange.call(self,file,getExt(file))==false)return;self._settings.autoSubmit&&self.submit()});addEvent(input,"click",function(){self.justClicked=true;setTimeout(function(){self.justClicked=false},2500)});this._input=input},_rerouteClicks:function(){var self=this,box,dialogOffset={top:0,left:0},over=false;addEvent(self._button,"mouseover",function(){if(!self._input||over)return;over=true;box=getBox(self._button);if(self._parentDialog!=d.body)dialogOffset=getOffset(self._parentDialog)});addEvent(document,"mousemove",function(e){var input=self._input;if(!input||!over)return;if(self._disabled){removeClass(self._button,"hover");input.style.display="none";return}var c=getMouseCoords(e);if(c.x>=box.left&&c.x<=box.right&&c.y>=box.top&&c.y<=box.bottom){input.style.top=c.y-dialogOffset.top+"px";input.style.left=c.x-dialogOffset.left+"px";input.style.display="block";addClass(self._button,"hover")}else{over=false;var check=setInterval(function(){if(self.justClicked)return;if(!over)input.style.display="none";clearInterval(check)},25);removeClass(self._button,"hover")}})},_createIframe:function(){var id=getUID(),iframe=toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.id=id;iframe.style.display="none";d.body.appendChild(iframe);return iframe},submit:function(){var self=this,settings=this._settings;if(this._input.value==="")return;var file=fileFromPath(this._input.value);if(!(settings.onSubmit.call(this,file,getExt(file))==false)){var iframe=this._createIframe(),form=this._createForm(iframe);form.appendChild(this._input);form.submit();d.body.removeChild(form);form=null;this._input=null;this._createInput();if(settings.isJsonpRequest)return;var toDeleteFlag=false;addEvent(iframe,"load",function(){if(iframe.src=="javascript:'%3Chtml%3E%3C/html%3E';"||iframe.src=="javascript:'<html></html>';"){toDeleteFlag&&setTimeout(function(){d.body.removeChild(iframe)},0);return}var doc=iframe.contentDocument?iframe.contentDocument:frames[iframe.id].document;if(doc.readyState&&doc.readyState!="complete")return;if(doc.body&&doc.body.innerHTML=="false")return;var response;if(doc.XMLDocument)response=doc.XMLDocument;else if(doc.body){response=doc.body.innerHTML;if(settings.responseType&&settings.responseType.toLowerCase()=="json"){if(doc.body.firstChild&&doc.body.firstChild.nodeName.toUpperCase()=="PRE")response=doc.body.firstChild.firstChild.nodeValue;if(response)response=window.eval("("+response+")");else response={}}}else var response=doc;settings.onComplete.call(self,file,response);toDeleteFlag=true;iframe.src="javascript:'<html></html>';"})}else{d.body.removeChild(this._input);this._input=null;this._createInput()}},_createForm:function(iframe){var settings=this._settings,form=toElement('<form method="post" enctype="multipart/form-data"></form>');form.style.display="none";form.action=settings.action;form.target=iframe.name;d.body.appendChild(form);for(var prop in settings.data){var el=d.createElement("input");el.type="hidden";el.name=prop;el.value=settings.data[prop];form.appendChild(el)}return form}}})();(function($){var isOpare=/opera/.test(navigator.userAgent.toLowerCase()),isMsie=/msie/.test(navigator.userAgent.toLowerCase());$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=="string"){method=settings;params=extraSettings}options={id:"",nameSpace:"rtftext",root:"",previewHandler:false,previewInWindow:"width=800, height=600, resizable=yes, scrollbars=yes",previewInElement:"",previewAutoRefresh:false,previewPosition:"after",previewTemplatePath:"/multitenant/handler/preview?domain="+document.domain,previewParser:false,previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);!options.root&&$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null)options.root=miuScript[1]});return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}return}function localize(data,inText){return inText?data.replace(/("|')~\//g,"$1"+options.root):data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id)id='id="'+options.id+'"';else if($$.attr("id"))id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"';if(options.nameSpace)nameSpace='class="'+options.nameSpace+'"';$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp)});footer.append(resizeHandle)}$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed);$$.bind("insertion.markItUp",function(e,settings){settings.target!==false&&get();textarea===$.markItUp.focused&&markup(settings)});$$.bind("focus.markItUp",function(){$.markItUp.focused=this});options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"";key=button.key?'accesskey="'+button.key+'"':"";if(button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{i++;for(j=levels.length-1;j>=0;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return false}).bind("click.markItUp",function(){return false}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){if(button.call)if(button.call=="preview")preview();else(eval(button.call))();setTimeout(function(){markup(button)},1);return false}).bind("mouseenter.markItUp",function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");return altKey===true?b[1]!==undefined?b[1]:b[0]:b[1]===undefined?"":b[0]});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true)return false;value=prompt(b[0],b[1]?b[1]:"");if(value===null)abort=true;return value});return string}return""}function prepare(action){if($.isFunction(action))action=action(hash);return magicMarkups(action)}function build(string){var openWith=prepare(clicked.openWith),placeHolder=prepare(clicked.placeHolder),replaceWith=prepare(clicked.replaceWith),closeWith=prepare(clicked.closeWith),openBlockWith=prepare(clicked.openBlockWith),closeBlockWith=prepare(clicked.closeBlockWith),multiline=clicked.multiline;if(replaceWith!=="")block=openWith+replaceWith+closeWith;else if(selection===""&&placeHolder!=="")block=openWith+placeHolder+closeWith;else{string=string||selection;var lines=[string],blocks=[];if(multiline===true)lines=string.split(/\r?\n/);for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/))blocks.push(openWith+line.replace(/ *$/g,"")+closeWith+trailingSpaces);else blocks.push(openWith+line+closeWith)}block=blocks.join("\n")}block=openBlockWith+block+closeBlockWith;return{block:block,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);(ctrlKey===true&&shiftKey===true||button.multiline===true)&&prepare(clicked.beforeMultiInsert);$.extend(hash,{line:1});if(ctrlKey===true&&shiftKey===true){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++)if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else lines[i]="";string={block:lines.join("\n")};start=caretPosition;len=string.block.length+(isOpare?n-1:0)}else if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block)}else if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}if(selection===""&&string.replaceWith===""){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else caretOffset=-1;get();$.extend(hash,{line:"",selection:selection});(ctrlKey===true&&shiftKey===true||button.multiline===true)&&prepare(clicked.afterMultiInsert);prepare(clicked.afterInsert);prepare(options.afterInsert);previewWindow&&options.previewAutoRefresh&&refreshPreview();shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){return isOpare?string.length-string.replace(/\n*/g,"").length:0}function fixIeBug(string){return isMsie?string.length-string.replace(/\r*/g,"").length:0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(start,len){if(textarea.createTextRange){if(isOpare&&$.browser.version>=9.5&&len==0)return false;range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(start,start+len);textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if(isMsie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else caretPosition=textarea.selectionStart}else{caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(typeof options.previewHandler==="function")previewWindow=true;else if(options.previewInElement)previewWindow=$(options.previewInElement);else if(!previewWindow||previewWindow.closed)if(options.previewInWindow){previewWindow=window.open(options.previewTemplatePath,"preview",options.previewInWindow);$(window).unload(function(){previewWindow.close()})}else{iFrame=$('<iframe class="markItUpPreviewFrame" src="'+options.previewTemplatePath+'"></iframe>');if(options.previewPosition=="after")iFrame.insertAfter(footer);else iFrame.insertBefore(header);previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}else if(altKey===true){if(iFrame)iFrame.remove();else previewWindow.close();previewWindow=iFrame=false}!options.previewAutoRefresh&&refreshPreview();options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==="function")options.previewHandler($$.val());else if(options.previewParser&&typeof options.previewParser==="function"){var data=options.previewParser($$.val());writeInPreview(localize(data,1))}else if(options.previewParserPath!=="")$.ajax({type:"POST",dataType:"text",global:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1))}});else!template&&$.ajax({url:options.previewTemplatePath,dataType:"text",global:false,success:function(data){setTimeout(function(){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()))},200)}});return false}function writeInPreview(data){if(options.previewInElement)$(options.previewInElement).html(data);else if(previewWindow&&previewWindow.document){var doc=previewWindow.document||previewWindow.contentDocument;try{sp=doc.documentElement.scrollTop}catch(e){sp=0}doc.open();doc.write(data);doc.close();doc.documentElement.scrollTop=sp}}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=!(e.altKey&&e.ctrlKey)?e.ctrlKey||e.metaKey:false;if(e.type==="keydown"){if(ctrlKey===true){li=$('a[accesskey="'+(e.keyCode==13?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li");if(li.length!==0){ctrlKey=false;setTimeout(function(){li.triggerHandler("mouseup")},1);return false}}if(e.keyCode===13||e.keyCode===10)if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true)return false;if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$);$$.data("markItUp",null)}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target)return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])});else $("textarea").trigger("insertion",[options])}})(jQuery);mySettings={onShiftEnter:{keepDefault:false,replaceWith:"<br />\n"},onCtrlEnter:{keepDefault:false,openWith:"\n<p>",closeWith:"</p>\n"},onTab:{keepDefault:false,openWith:"\t "},markupSet:[{name:"Heading 1",key:"1",openWith:'<h1(!( class="[![Class]!]")!)>',closeWith:"</h1>",placeHolder:"Your title here..."},{name:"Heading 2",key:"2",openWith:'<h2(!( class="[![Class]!]")!)>',closeWith:"</h2>",placeHolder:"Your title here..."},{name:"Heading 3",key:"3",openWith:'<h3(!( class="[![Class]!]")!)>',closeWith:"</h3>",placeHolder:"Your title here..."},{name:"Heading 4",key:"4",openWith:'<h4(!( class="[![Class]!]")!)>',closeWith:"</h4>",placeHolder:"Your title here..."},{name:"Heading 5",key:"5",openWith:'<h5(!( class="[![Class]!]")!)>',closeWith:"</h5>",placeHolder:"Your title here..."},{name:"Heading 6",key:"6",openWith:'<h6(!( class="[![Class]!]")!)>',closeWith:"</h6>",placeHolder:"Your title here..."},{name:"Paragraph",openWith:'<p(!( class="[![Class]!]")!)>',closeWith:"</p>"},{separator:"---------------"},{name:"Bold",key:"B",openWith:"(!(<strong>|!|<b>)!)",closeWith:"(!(</strong>|!|</b>)!)"},{name:"Italic",key:"I",openWith:"(!(<em>|!|<i>)!)",closeWith:"(!(</em>|!|</i>)!)"},{name:"Stroke through",key:"S",openWith:"<del>",closeWith:"</del>"},{separator:"---------------"},{name:"Ul",openWith:"<ul>\n",closeWith:"</ul>\n"},{name:"Ol",openWith:"<ol>\n",closeWith:"</ol>\n"},{name:"Li",openWith:"<li>",closeWith:"</li>"},{separator:"---------------"},{name:"Picture",key:"P",replaceWith:'<img src="[![Source:!:http://]!]" alt="[![Alternative text]!]" />'},{name:"Link",key:"L",openWith:'<a href="[![Link:!:http://]!]"(!( title="[![Title]!]")!)>',closeWith:"</a>",placeHolder:"Your text to link..."},{separator:"---------------"},{name:"Clean",className:"clean",replaceWith:function(markitup){return markitup.selection.replace(/<(.*?)>/g,"")}},{name:"Preview",className:"preview",call:"preview"}]};function dateControl(formName,startName,endName,name){this.startYearSel=$('form[name="'+formName+'"] select[name="'+startName+'_Year"]');this.startMonthSel=$('form[name="'+formName+'"] select[name="'+startName+'_Month"]');this.startVal=$('form[name="'+formName+'"] input[name="'+startName+'"]');this.endYearSel=$('form[name="'+formName+'"] select[name="'+endName+'_Year"]');this.endMonthSel=$('form[name="'+formName+'"] select[name="'+endName+'_Month"]');this.endVal=$('form[name="'+formName+'"] input[name="'+endName+'"]');this.toNow=$('form[name="'+formName+'"] input[name="'+endName+'_ToNow"]');this.doubleModel=name==endName;this.name=this.doubleModel?endName:name;this.value=$('form[name="'+formName+'"] input[name="'+this.name+'"]')}dateControl.prototype={initSelect:function(){var ey=(new Date).getFullYear();this.bindSelValue(this.startYearSel,this.startMonthSel,1970,1,ey,12);this.bindSelValue(this.endYearSel,this.endMonthSel,1970,1,ey+5,12)},bindSelValue:function(ysel,msel,sy,sm,ey,em){sy=sy||1970;sm=sm||1;ysel.empty();msel.empty();var emptyOption="<option></option>";ysel.append(emptyOption);for(var i=parseInt(sy);i<=ey;i++){var option='<option value="'+i+'">'+i+"</option>";ysel.append(option)}msel.append(emptyOption);for(var i=parseInt(sm);i<=em;i++){var option='<option value="'+i+'">'+i+"</option>";msel.append(option)}},initStartValue:function(){var v=this.startVal.val();if(v=="")return;var d=v.split("/"),y=parseInt(d[0],10),m=parseInt(d[1],10);this.startYearSel.find('option[value="'+y+'"]').attr("selected",true);this.startMonthSel.find('option[value="'+m+'"]').attr("selected",true)},initEndValue:function(){var v=this.endVal.val();if(v==""){this.endYearSel.attr("disabled",false);this.endMonthSel.attr("disabled",false);return}var d=v.split("/"),y=parseInt(d[0],10),m=parseInt(d[1],10);if(y==9999){this.endYearSel.attr("disabled",true);this.endMonthSel.attr("disabled",true);this.toNow.attr("checked",true)}else{this.endYearSel.find('option[value="'+y+'"]').attr("selected",true);this.endMonthSel.find('option[value="'+m+'"]').attr("selected",true);this.toNow.attr("checked",false)}},initVal:function(){if(!this.doubleModel){var v=this.value.val();if(v!=""){this.startVal.val(v.split("-")[0]);this.endVal.val(v.split("-")[1])}}this.initStartValue();this.initEndValue()},initEvent:function(){var me=this;this.startYearSel.change(function(){me.setVal()});this.startMonthSel.change(function(){me.setVal()});this.endYearSel.change(function(){me.setVal()});this.endMonthSel.change(function(){me.setVal()});this.toNow.click(function(){me.endYearSel.val("");me.endMonthSel.val("");if(me.toNow.attr("checked"))me.endVal.val("9999/12/31");else me.endVal.val("");me.initEndValue();me.setVal()})},initValidate:function(){var me=this;$.validator.addMethod(this.name+"_dtVal",function(){var sv=me.startVal.val(),ev=me.endVal.val();return sv==""&&ev==""?true:sv==""||ev==""?false:new Date(sv)>new Date(ev)?false:true},"时间有误");this.value.addClass('{"'+this.name+'_dtVal":true}')},setVal:function(){var sy=this.startYearSel.val(),sm=this.startMonthSel.val();if(sy==""||sm=="")this.startVal.val("");else this.startVal.val(sy+"/"+sm+"/1");var ey=this.endYearSel.val(),em=this.endMonthSel.val();if(ey==""||em=="")if(this.toNow.attr("checked"))this.endVal.val("9999/12/31");else this.endVal.val("");else this.endVal.val(ey+"/"+em+"/1");if(!this.doubleModel)this.startVal.val()!=""&&this.endVal.val()!=""&&this.value.val(this.startVal.val()+"-"+this.endVal.val())},init:function(){this.initSelect();this.initVal();this.initEvent();this.initValidate()}};(function($){var isOpare=/opera/.test(navigator.userAgent.toLowerCase()),isMsie=/msie/.test(navigator.userAgent.toLowerCase());$.fn.extend({autocomplete:function(urlOrData,options){var isUrl=typeof urlOrData=="string";options=$.extend({},$.Autocompleter.defaults,{url:isUrl?urlOrData:null,data:isUrl?null:urlOrData,delay:isUrl?$.Autocompleter.defaults.delay:10,max:options&&!options.scroll?10:150},options);options.highlight=options.highlight||function(value){return value};options.formatMatch=options.formatMatch||options.formatItem;return this.each(function(){new $.Autocompleter(this,options)})},result:function(handler){return this.bind("result",handler)},search:function(handler){return this.trigger("search",[handler])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(options){return this.trigger("setOptions",[options])},unautocomplete:function(){return this.trigger("unautocomplete")}});$.Autocompleter=function(input,options){var KEY={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},$input=$(input).attr("autocomplete","off").addClass(options.inputClass),timeout,previousValue="",cache=$.Autocompleter.Cache(options),hasFocus=0,lastKeyPressCode,config={mouseDownOnSelect:false},select=$.Autocompleter.Select(options,input,selectCurrent,config),blockSubmit;isOpare&&$(input.form).bind("submit.autocomplete",function(){if(blockSubmit){blockSubmit=false;return false}});$input.bind((isOpare?"keypress":"keydown")+".autocomplete",function(event){hasFocus=1;lastKeyPressCode=event.keyCode;switch(event.keyCode){case KEY.UP:event.preventDefault();if(select.visible())select.prev();else onChange(0,true);break;case KEY.DOWN:event.preventDefault();if(select.visible())select.next();else onChange(0,true);break;case KEY.PAGEUP:event.preventDefault();if(select.visible())select.pageUp();else onChange(0,true);break;case KEY.PAGEDOWN:event.preventDefault();if(select.visible())select.pageDown();else onChange(0,true);break;case options.multiple&&$.trim(options.multipleSeparator)==","&&KEY.COMMA:case KEY.TAB:case KEY.RETURN:if(selectCurrent()){event.preventDefault();blockSubmit=true;return false}break;case KEY.ESC:select.hide();break;default:clearTimeout(timeout);timeout=setTimeout(onChange,options.delay)}}).focus(function(){hasFocus++}).blur(function(){hasFocus=0;!config.mouseDownOnSelect&&hideResults()}).click(function(){hasFocus++>1&&!select.visible()&&onChange(0,true)}).bind("search",function(){var fn=arguments.length>1?arguments[1]:null;function findValueCallback(q,data){var result;if(data&&data.length)for(var i=0;i<data.length;i++)if(data[i].result.toLowerCase()==q.toLowerCase()){result=data[i];break}if(typeof fn=="function")fn(result);else $input.trigger("result",result&&[result.data,result.value])}$.each(trimWords($input.val()),function(i,value){request(value,findValueCallback,findValueCallback)})}).bind("flushCache",function(){cache.flush()}).bind("setOptions",function(){$.extend(options,arguments[1]);"data"in arguments[1]&&cache.populate()}).bind("unautocomplete",function(){select.unbind();$input.unbind();$(input.form).unbind(".autocomplete")});function selectCurrent(){var selected=select.selected();if(!selected)return false;var v=selected.result;previousValue=v;if(options.multiple){var words=trimWords($input.val());if(words.length>1){var seperator=options.multipleSeparator.length,cursorAt=$(input).selection().start,wordAt,progress=0;$.each(words,function(i,word){progress+=word.length;if(cursorAt<=progress){wordAt=i;return false}progress+=seperator});words[wordAt]=v;v=words.join(options.multipleSeparator)}v+=options.multipleSeparator}$input.val(v);hideResultsNow();$input.trigger("result",[selected.data,selected.value]);return true}function onChange(crap,skipPrevCheck){if(lastKeyPressCode==KEY.DEL){select.hide();return}var currentValue=$input.val();if(!skipPrevCheck&&currentValue==previousValue)return;previousValue=currentValue;currentValue=lastWord(currentValue);if(currentValue.length>=options.minChars){$input.addClass(options.loadingClass);if(!options.matchCase)currentValue=currentValue.toLowerCase();request(currentValue,receiveData,hideResultsNow)}else{stopLoading();select.hide()}}function trimWords(value){return!value?[""]:!options.multiple?[$.trim(value)]:$.map(value.split(options.multipleSeparator),function(word){return $.trim(value).length?$.trim(word):null})}function lastWord(value){if(!options.multiple)return value;var words=trimWords(value);if(words.length==1)return words[0];var cursorAt=$(input).selection().start;if(cursorAt==value.length)words=trimWords(value);else words=trimWords(value.replace(value.substring(cursorAt),""));return words[words.length-1]}function autoFill(q,sValue){if(options.autoFill&&lastWord($input.val()).toLowerCase()==q.toLowerCase()&&lastKeyPressCode!=KEY.BACKSPACE){$input.val($input.val()+sValue.substring(lastWord(previousValue).length));$(input).selection(previousValue.length,previousValue.length+sValue.length)}}function hideResults(){clearTimeout(timeout);timeout=setTimeout(hideResultsNow,200)}function hideResultsNow(){var wasVisible=select.visible();select.hide();clearTimeout(timeout);stopLoading();options.mustMatch&&$input.search(function(result){if(!result)if(options.multiple){var words=trimWords($input.val()).slice(0,-1);$input.val(words.join(options.multipleSeparator)+(words.length?options.multipleSeparator:""))}else{$input.val("");$input.trigger("result",null)}})}function receiveData(q,data){if(data&&data.length&&hasFocus){stopLoading();select.display(data,q);autoFill(q,data[0].value);select.show()}else hideResultsNow()}function request(term,success,failure){if(!options.matchCase)term=term.toLowerCase();var data=cache.load(term);if(data&&data.length)success(term,data);else if(typeof options.url=="string"&&options.url.length>0){var extraParams={timestamp:+new Date};$.each(options.extraParams,function(key,param){extraParams[key]=typeof param=="function"?param():param});$.ajax({mode:"abort",port:"autocomplete"+input.name,dataType:options.dataType,url:options.url,data:$.extend({q:lastWord(term),limit:options.max},extraParams),success:function(data){var parsed=options.parse&&options.parse(data)||parse(data);cache.add(term,parsed);success(term,parsed)}})}else{select.emptyList();failure(term)}}function parse(data){for(var parsed=[],rows=data.split("\n"),i=0;i<rows.length;i++){var row=$.trim(rows[i]);if(row){row=row.split("|");parsed[parsed.length]={data:row,value:row[0],result:options.formatResult&&options.formatResult(row,row[0])||row[0]}}}return parsed}function stopLoading(){$input.removeClass(options.loadingClass)}};$.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:false,matchSubset:true,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(row){return row[0]},formatMatch:null,autoFill:false,width:0,multiple:false,multipleSeparator:", ",highlight:function(value,term){return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:true,scrollHeight:300};$.Autocompleter.Cache=function(options){var data={},length=0;function matchSubset(s,sub){if(!options.matchCase)s=s.toLowerCase();var i=s.indexOf(sub);if(options.matchContains=="word")i=s.toLowerCase().search("\\b"+sub.toLowerCase());return i==-1?false:i==0||options.matchContains}function add(q,value){length>options.cacheLength&&flush();if(!data[q])length++;data[q]=value}function populate(){if(!options.data)return false;var stMatchSets={},nullData=0;if(!options.url)options.cacheLength=1;stMatchSets[""]=[];for(var i=0,ol=options.data.length;i<ol;i++){var rawValue=options.data[i];rawValue=typeof rawValue=="string"?[rawValue]:rawValue;var value=options.formatMatch(rawValue,i+1,options.data.length);if(value===false)continue;var firstChar=value.charAt(0).toLowerCase();if(!stMatchSets[firstChar])stMatchSets[firstChar]=[];var row={value:value,data:rawValue,result:options.formatResult&&options.formatResult(rawValue)||value};stMatchSets[firstChar].push(row);nullData++<options.max&&stMatchSets[""].push(row)}$.each(stMatchSets,function(i,value){options.cacheLength++;add(i,value)})}setTimeout(populate,25);function flush(){data={};length=0}return{flush:flush,add:add,populate:populate,load:function(q){if(!options.cacheLength||!length)return null;if(!options.url&&options.matchContains){var csub=[];for(var k in data)if(k.length>0){var c=data[k];$.each(c,function(i,x){matchSubset(x.value,q)&&csub.push(x)})}return csub}else if(data[q])return data[q];else if(options.matchSubset)for(var i=q.length-1;i>=options.minChars;i--){var c=data[q.substr(0,i)];if(c){var csub=[];$.each(c,function(i,x){if(matchSubset(x.value,q))csub[csub.length]=x});return csub}}return null}}};$.Autocompleter.Select=function(options,input,select,config){var CLASSES={ACTIVE:"ac_over"},listItems,active=-1,data,term="",needsInit=true,element,list;function init(){if(!needsInit)return;element=$("<div/>").hide().addClass(options.resultsClass).css("position","absolute").appendTo(document.body);list=$("<ul/>").appendTo(element).mouseover(function(event){if(target(event).nodeName&&target(event).nodeName.toUpperCase()=="LI"){active=$("li",list).removeClass(CLASSES.ACTIVE).index(target(event));$(target(event)).addClass(CLASSES.ACTIVE)}}).click(function(event){$(target(event)).addClass(CLASSES.ACTIVE);select();input.focus();return false}).mousedown(function(){config.mouseDownOnSelect=true}).mouseup(function(){config.mouseDownOnSelect=false});options.width>0&&element.css("width",options.width);needsInit=false}function target(event){var element=event.target;while(element&&element.tagName!="LI")element=element.parentNode;return!element?[]:element}function moveSelect(step){listItems.slice(active,active+1).removeClass(CLASSES.ACTIVE);movePosition(step);var activeItem=listItems.slice(active,active+1).addClass(CLASSES.ACTIVE);if(options.scroll){var offset=0;listItems.slice(0,active).each(function(){offset+=this.offsetHeight});if(offset+activeItem[0].offsetHeight-list.scrollTop()>list[0].clientHeight)list.scrollTop(offset+activeItem[0].offsetHeight-list.innerHeight());else offset<list.scrollTop()&&list.scrollTop(offset)}}function movePosition(step){active+=step;if(active<0)active=listItems.size()-1;else if(active>=listItems.size())active=0}function limitNumberOfItems(available){return options.max&&options.max<available?options.max:available}function fillList(){list.empty();for(var max=limitNumberOfItems(data.length),i=0;i<max;i++){if(!data[i])continue;var formatted=options.formatItem(data[i].data,i+1,max,data[i].value,term);if(formatted===false)continue;var li=$("<li/>").html(options.highlight(formatted,term)).addClass(i%2==0?"ac_even":"ac_odd").appendTo(list)[0];$.data(li,"ac_data",data[i])}listItems=list.find("li");if(options.selectFirst){listItems.slice(0,1).addClass(CLASSES.ACTIVE);active=0}}return{display:function(d,q){init();data=d;term=q;fillList()},next:function(){moveSelect(1)},prev:function(){moveSelect(-1)},pageUp:function(){if(active!=0&&active-8<0)moveSelect(-active);else moveSelect(-8)},pageDown:function(){if(active!=listItems.size()-1&&active+8>listItems.size())moveSelect(listItems.size()-1-active);else moveSelect(8)},hide:function(){element&&element.hide();listItems&&listItems.removeClass(CLASSES.ACTIVE);active=-1},visible:function(){return element&&element.is(":visible")},current:function(){return this.visible()&&(listItems.filter("."+CLASSES.ACTIVE)[0]||options.selectFirst&&listItems[0])},show:function(){var offset=$(input).offset();element.css({width:typeof options.width=="string"||options.width>0?options.width:$(input).width(),top:offset.top+input.offsetHeight,left:offset.left}).show();if(options.scroll){list.scrollTop(0);list.css({maxHeight:options.scrollHeight,overflow:"auto"});if(isMsie&&typeof document.body.style.maxHeight==="undefined"){var listHeight=0;listItems.each(function(){listHeight+=this.offsetHeight});var scrollbarsVisible=listHeight>options.scrollHeight;list.css("height",scrollbarsVisible?options.scrollHeight:listHeight);!scrollbarsVisible&&listItems.width(list.width()-parseInt(listItems.css("padding-left"))-parseInt(listItems.css("padding-right")))}}},selected:function(){var selected=listItems&&listItems.filter("."+CLASSES.ACTIVE).removeClass(CLASSES.ACTIVE);return selected&&selected.length&&$.data(selected[0],"ac_data")},emptyList:function(){list&&list.empty()},unbind:function(){element&&element.remove()}}};$.fn.selection=function(start,end){if(start!==undefined)return this.each(function(){if(this.createTextRange){var selRange=this.createTextRange();if(end===undefined||start==end){selRange.move("character",start);selRange.select()}else{selRange.collapse(true);selRange.moveStart("character",start);selRange.moveEnd("character",end);selRange.select()}}else if(this.setSelectionRange)this.setSelectionRange(start,end);else if(this.selectionStart){this.selectionStart=start;this.selectionEnd=end}});var field=this[0];if(field.createTextRange){var range=document.selection.createRange(),orig=field.value,teststring="<->",textLength=range.text.length;range.text=teststring;var caretAt=field.value.indexOf(teststring);field.value=orig;this.selection(caretAt,caretAt+textLength);return{start:caretAt,end:caretAt+textLength}}else if(field.selectionStart!==undefined)return{start:field.selectionStart,end:field.selectionEnd}}})(jQuery);(function($){$.extend($.fn,{validate:function(options){if(!this.length){options&&options.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var validator=$.data(this[0],"validator");if(validator)return validator;validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){validator.cancelSubmit=true});validator.settings.submitHandler&&this.find("input, button").filter(":submit").click(function(){validator.submitButton=this});this.submit(function(event){validator.settings.debug&&event.preventDefault();function handle(){if(validator.settings.submitHandler){if(validator.submitButton)var hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val(validator.submitButton.value).appendTo(validator.currentForm);validator.settings.submitHandler.call(validator,validator.currentForm);validator.submitButton&&hidden.remove();return false}return true}if(validator.cancelSubmit){validator.cancelSubmit=false;return handle()}if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false}return handle()}else{validator.focusInvalid();return false}})}return validator},valid:function(){if($(this[0]).is("form"))return this.validate().form();else{var valid=true,validator=$(this[0].form).validate();this.each(function(){valid&=validator.element(this)});return valid}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value)});return result},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,"validator").settings,staticRules=settings.rules,existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));staticRules[element.name]=existingRules;if(argument.messages)settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages);break;case"remove":if(!argument){delete staticRules[element.name];return existingRules}var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method]});return filtered}}var data=$.validator.normalizeRules($.extend({},$.validator.metadataRules(element),$.validator.classRules(element),$.validator.attributeRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data)}return data}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+a.value)},filled:function(a){return!!$.trim(""+a.value)},unchecked:function(a){return!a.checked}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init()};$.validator.format=function(source,params){if(arguments.length==1)return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args)};if(arguments.length>2&&params.constructor!=Array)params=$.makeArray(arguments).slice(1);if(params.constructor!=Array)params=[params];$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),n)});return source};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(element){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(element)).hide()}},onfocusout:function(element){!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))&&this.element(element)},onkeyup:function(element){(element.name in this.submitted||element==this.lastElement)&&this.element(element)},onclick:function(element){if(element.name in this.submitted)this.element(element);else element.parentNode.name in this.submitted&&this.element(element.parentNode)},highlight:function(element,errorClass,validClass){$(element).addClass(errorClass).removeClass(validClass)},unhighlight:function(element,errorClass,validClass){$(element).removeClass(errorClass).addClass(validClass)}},setDefaults:function(settings){$.extend($.validator.defaults,settings)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=this.groups={};$.each(this.settings.groups,function(key,value){$.each(value.split(/\s/),function(index,name){groups[name]=key})});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value)});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");validator.settings[eventType]&&validator.settings[eventType].call(validator,this[0])}$(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",delegate).validateDelegate(":radio, :checkbox, select, option","click",delegate);this.settings.invalidHandler&&$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);!this.valid()&&$(this.currentForm).triggerHandler("invalid-form",[this]);this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var i=0,elements=this.currentElements=this.elements();elements[i];i++)this.check(elements[i]);return this.valid()},element:function(element){element=this.clean(element);this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element);if(result)delete this.invalid[element.name];else this.invalid[element.name]=true;if(!this.numberOfInvalids())this.toHide=this.toHide.add(this.containers);this.showErrors();return result},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors)this.errorList.push({message:errors[name],element:this.findByName(name)[0]});this.successList=$.grep(this.successList,function(element){return!(element.name in errors)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){$.fn.resetForm&&$(this.currentForm).resetForm();this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(obj){var count=0;for(var i in obj)count++;return count},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name==lastActive.name}).length==1&&lastActive},elements:function(){for(var validator=this,rulesCache={},listeElements=[],i=0;i<this.currentForm.elements.length;i++)listeElements[i]=this.currentForm.elements[i];return $([]).add(listeElements).filter(":input").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&validator.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in rulesCache||!validator.objectLength($(this).rules()))return false;rulesCache[this.name]=true;return true})},clean:function(selector){return $(selector)[0]},errors:function(){return $(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element)},check:function(element){element=this.clean(element);if(this.checkable(element))element=this.findByName(element.name).not(this.settings.ignore)[0];var rules=$(element).rules(),dependencyMismatch=false;for(var method in rules){var rule={method:method,parameters:rules[method]};try{var result=$.validator.methods[method].call(this,element.value.replace(/\r/g,""),element,rule.parameters);if(result=="dependency-mismatch"){dependencyMismatch=true;continue}dependencyMismatch=false;if(result=="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return}if(!result){this.formatAndAdd(element,rule);return false}}catch(e){this.settings.debug&&window.console&&console.log("exception occured when checking element "+element.id+", check the '"+rule.method+"' method",e);throw e;}}if(dependencyMismatch)return;this.objectLength(rules)&&this.successList.push(element);return true},customMetaMessage:function(element,method){if(!$.metadata)return;var meta=this.settings.meta?$(element).metadata()[this.settings.meta]:$(element).metadata();return meta&&meta.messages&&meta.messages[method]},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor==String?m:m[method])},findDefined:function(){for(var i=0;i<arguments.length;i++)if(arguments[i]!==undefined)return arguments[i];return undefined},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customMetaMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>")},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message=="function")message=message.call(this,rule.parameters,element);else if(theregex.test(message))message=jQuery.format(message.replace(theregex,"{$1}"),rule.parameters);this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message},addWrapper:function(toToggle){if(this.settings.wrapper)toToggle=toToggle.add(toToggle.parent(this.settings.wrapper));return toToggle},defaultShowErrors:function(){for(var i=0;this.errorList[i];i++){var error=this.errorList[i];this.settings.highlight&&this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass);this.showLabel(error.element,error.message)}if(this.errorList.length)this.toShow=this.toShow.add(this.containers);if(this.settings.success)for(var i=0;this.successList[i];i++)this.showLabel(this.successList[i]);if(this.settings.unhighlight)for(var i=0,elements=this.validElements();elements[i];i++)this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return $(this.errorList).map(function(){return this.element})},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass().addClass(this.settings.errorClass);label.attr("generated")&&label.html(message)}else{label=$("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(element),generated:true}).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper)label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();if(!this.labelContainer.append(label).length)this.settings.errorPlacement?this.settings.errorPlacement(label,$(element)):label.insertAfter(element)}if(!message&&this.settings.success){label.text("");typeof this.settings.success=="string"?label.addClass(this.settings.success):this.settings.success(label)}this.toShow=this.toShow.add(label)},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr("for")==name})},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name)},checkable:function(element){return/radio|checkbox/i.test(element.type)},findByName:function(name){var form=this.currentForm;return $(document.getElementsByName(name)).map(function(index,element){return element.form==form&&element.name==name&&element||null})},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element))return this.findByName(element.name).filter(":checked").length}return value.length},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true},dependTypes:{"boolean":function(param){return param},string:function(param,element){return!!$(param,element.form).length},"function":function(param,element){return param(element)}},optional:function(element){return!$.validator.methods.required.call(this,$.trim(element.value),element)&&"dependency-mismatch"},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0)this.pendingRequest=0;delete this.pending[element.name];if(valid&&this.pendingRequest==0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false}else if(!valid&&this.pendingRequest==0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){className.constructor==String?(this.classRuleSettings[className]=rules):$.extend(this.classRuleSettings,className)},classRules:function(element){var rules={},classes=$(element).attr("class");classes&&$.each(classes.split(" "),function(){this in $.validator.classRuleSettings&&$.extend(rules,$.validator.classRuleSettings[this])});return rules},attributeRules:function(element){var rules={},$element=$(element);for(var method in $.validator.methods){var value=$element.attr(method);if(value)rules[method]=value}if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength))delete rules.maxlength;return rules},metadataRules:function(element){if(!$.metadata)return{};var meta=$.data(element.form,"validator").settings.meta;return meta?$(element).metadata()[meta]:$(element).metadata()},staticRules:function(element){var rules={},validator=$.data(element.form,"validator");if(validator.settings.rules)rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{};return rules},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return}if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element)}if(keepRule)rules[prop]=val.param!==undefined?val.param:true;else delete rules[prop]}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter});$.each(["minlength","maxlength","min","max"],function(){if(rules[this])rules[this]=Number(rules[this])});$.each(["rangelength","range"],function(){if(rules[this])rules[this]=[Number(rules[this][0]),Number(rules[this][1])]});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max}if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength}}if(rules.messages)delete rules.messages;return rules},normalizeRule:function(data){if(typeof data=="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true});data=transformed}return data},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!=undefined?message:$.validator.messages[name];method.length<3&&$.validator.addClassRules(name,$.validator.normalizeRule(name))},methods:{required:function(value,element,param){if(!this.depend(param,element))return"dependency-mismatch";switch(element.nodeName.toLowerCase()){case"select":var val=$(element).val();return val&&val.length>0;case"input":if(this.checkable(element))return this.getLength(value,element)>0;default:return $.trim(value).length>0}},remote:function(value,element,param){if(this.optional(element))return"dependency-mismatch";var previous=this.previousValue(element);if(!this.settings.messages[element.name])this.settings.messages[element.name]={};previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param=="string"&&{url:param}||param;if(this.pending[element.name])return"pending";if(previous.old===value)return previous.valid;previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true;if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);validator.showErrors()}else{var errors={},message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.showErrors(errors)}previous.valid=valid;validator.stopRequest(element,valid)}},param));return"pending"},minlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)>=param},maxlength:function(value,element,param){return this.optional(element)||this.getLength($.trim(value),element)<=param},rangelength:function(value,element,param){var length=this.getLength($.trim(value),element);return this.optional(element)||length>=param[0]&&length<=param[1]},min:function(value,element,param){return this.optional(element)||value>=param},max:function(value,element,param){return this.optional(element)||value<=param},range:function(value,element,param){return this.optional(element)||value>=param[0]&&value<=param[1]},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value)},url:function(value,element){return this.optional(element)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value)},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value))},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(value)},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(value)},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value)},creditcard:function(value,element){if(this.optional(element))return"dependency-mismatch";if(/[^0-9-]+/.test(value))return false;var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n),nDigit=parseInt(cDigit,10);if(bEven)if((nDigit*=2)>9)nDigit-=9;nCheck+=nDigit;bEven=!bEven}return nCheck%10==0},accept:function(value,element,param){param=typeof param=="string"?param.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(element)||value.match(new RegExp(".("+param+")$","i"))},equalTo:function(value,element,param){var target=$(param).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid()});return value==target.val()}}});$.format=$.validator.format})(jQuery);(function($){var pendingRequests={};if($.ajaxPrefilter)$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode=="abort"){pendingRequests[port]&&pendingRequests[port].abort();pendingRequests[port]=xhr}});else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode=="abort"){pendingRequests[port]&&pendingRequests[port].abort();return pendingRequests[port]=ajax.apply(this,arguments)}return ajax.apply(this,arguments)}}})(jQuery);(function($){!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener&&$.each({focus:"focusin",blur:"focusout"},function(original,fix){$.event.special[fix]={setup:function(){this.addEventListener(original,handler,true)},teardown:function(){this.removeEventListener(original,handler,true)},handler:function(e){arguments[0]=$.event.fix(e);arguments[0].type=fix;return $.event.handle.apply(this,arguments)}};function handler(e){e=$.event.fix(e);e.type=fix;return $.event.handle.call(this,e)}});$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate))return handler.apply(target,arguments)})}})})(jQuery);(function($){$.extend($.validator.messages,{required:"必填",remote:"请修正该字段",email:"邮箱格式不正确",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入大于0的整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",notEqualTo:"开始值要小于结束值",accept:"请输入拥有合法后缀名的字符串",maxlength:$.validator.format("最多输入{0}个字"),minlength:$.validator.format("最少输入{0}个字"),rangelength:$.validator.format("请输入一个长度介于 {0} 和 {1} 之间的字符串"),range:$.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:$.validator.format("最大允许{0}"),min:$.validator.format("最小允许{0}")})})(jQuery);(function($){$.extend($.validator.defaults,{errorClass:"new_pop_error",validClass:"valid",errorElement:"span",noticeClass:"new_pop_notice",noticeElement:"span",focusNotice:false})})(jQuery);(function(){jQuery.validator.addMethod("mobile",function(value,element){var length=value.length,mobile=/^([\d\-()\+]{11,13})$/;return this.optional(element)||mobile.test(value)},"手机号码格式错误");jQuery.validator.addMethod("plusminusnum",function(value,element){return this.optional(element)||/^-?[0-9]\d*$/.test(value)},"只能输入整数数字");jQuery.validator.addMethod("positiveNum",function(value,element){return this.optional(element)||/^[0-9]*[1-9][0-9]*$/.test(value)},"只能输入大于0的整数");jQuery.validator.prototype.getLength=function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element))return this.findByName(element.name).filter(":checked").length;case"textarea":var i=0;for(var c in value)if(value[c]=="\n")i++;return value.length+i}return value.length}})(jQuery)
