var ie6 = ! -[1, ] && !window.XMLHttpRequest;
window.onerror = function () { return false; }
function action() {
    $(document.body).append('<div id="roll" style="display:none;"><div title="回到顶部" id="roll_top"></div></div>');
    $("#roll_top").click(function () {
        $("html,body").animate({
            scrollTop: "0px"
        }, 800)
    });
    $("#ct").click(function () {
        $("html,body").animate({
            scrollTop: $(".ct").offset().top
        }, 800)
    });
    //使用浮动主导航
    //$(document.body).append($("div.header").clone().addClass("h_head_gd").hide());
    var div = $("div.h_head_gd");
    $(window).scroll(function (a) {

        if ($(this).scrollTop() > 260) {
            $("#roll").fadeIn()
        } else {
            $("#roll").fadeOut()
        }

        if ($(this).scrollTop() > 170) {
            div.show()
        } else {
            div.hide()
        }
    }).scroll();
};
//自动加载js执行效果 
if (typeof (console) == "undefined") {
    var console = function () { };
    console.log = function (msg) { }
}
$(function () {
    var FnAndJS = {
        "slide": ["/js/jquery.SuperSlide.2.1.1.js", "slide", function (data, src) {
            var src = jQuery(src);
            if ("slide" in src) {
                src.slide(data || {});
            }
        } ],
        "adgallery": ["/plug/ad-gallery/jquery.ad-gallery.js", "adGallery", function (data, src) {
            loadCss("/plug/ad-gallery/jquery.ad-gallery.css");
            var src = jQuery(src);
            if ("adGallery" in src) {
                setTimeout(function () {
                    src.adGallery(data || {});
                }, 500);
            }
        } ],
        "fancybox": ["/plug/fancybox/jquery.fancybox-1.3.4.pack.js", "fancybox", function (data, src, selector) {
            loadCss("/plug/fancybox/jquery.fancybox-1.3.4.css");
            var src = jQuery(src);
            if (selector) {
                src = src.find(selector);
            }
            if ("fancybox" in src) {
                setTimeout(function () {
                    src.fancybox(data || {});
                }, 500);
            }
        } ]
    };
    var Execution = function (fn, me, data, fnName, selector) { if (fn && jQuery.isFunction(fn)) { var rv = null; if (jQuery.isArray(data)) { rv = fn.apply(me, data) } else { rv = fn.apply(me, [data, me, selector]) } if (data["ExecutionCallback"] && fnName != "ExecutionCallback") { fn = data["ExecutionCallback"]; if (fn) { fn = window[fn]; Execution(fn, me, data, "ExecutionCallback", selector) } } } }; $(".plug[data-src]").each(function () { var me = $(this); var data_ = me.attr("data-src") || {}; var data = null; var fn = me.attr("fn") || "slide"; var selector = me.attr("selector") || ""; if (fn && (fn in FnAndJS || fn in window)) { try { data = jQuery.parseJSON(data_) } catch (e) { data = eval("(" + data_ + ")") } if (data) { try { if (fn in FnAndJS) { var arr = FnAndJS[fn]; if (arr && !(fn in me)) { var fn_ = arr[1]; if (fn_ && (fn_ = (me[fn_] || window[fn_]))) { Execution(fn_, me, data, "", selector) } else { fn_ = arr[1]; loadJs(arr[0], function () { Execution(arr[2] || me[fn_ || fn], me, data, "", selector) }) } } else { Execution(me[fn] || window[fn], me, data, "", selector) } } else { if (fn in window) { Execution(window[fn], me, data, "", selector) } } } catch (e) { console.log(e) } } } });
});
/*在线客服开始*/
function imState(){$.get("/ajax.ashx?action=imstate&t="+Math.random(),function(rsp){window.imInfo=eval("("+rsp+")");if(imInfo.imShow){$.getScript("/UserControls/Im/im.js?t="+Math.random(),function(){writeIm(imInfo.imData);});}else{$("#divOranIm").hide();}});}
$(function(){$("body").append("<div style='width:150px;z-index:10;' id='divOranIm'></div>");imState();});
/*在线客服结束*/
function SelectMenu() {
    var $menu = $("div.h-bo").eq(0);
    var length = 0;
    var _cur = "cur";
    if ('curUrl' in window) {
        var url = window.curUrl;
        var a = $menu.find('a[href="' + url + '"]');
        a = a.size() > 0 ? a : $menu.find('a[href="' + url + '/"]');
        if (a.size() > 0) {
            Selected(a.parent('li'));
            length = -1;
            return;
        }
    }
    var $info = $("div.plc,div.plc2,div.pro_curmbs").find("a");
    var Selected = function (li) {
        $(li).addClass(_cur);
    }
    var getCurrUrl = function (href) {
        href = href || '';
        var length = href.length;
        var index = href.lastIndexOf('/');
        if (index + 1 == length) {
            if ('/news/help/agent/job/feedback/friendlink/neatupload/product/project/search/user/'.concat(href)) {
                index = href.indexOf('/');
                length = length - 1
            } else {
                index = href.indexOf('/', index - 9)
            }
        }
        href = href.substr(index, length);
        if (!href.match(/\.[shtml|html|aspx]{4,5}/) && href.lastIndexOf('/') != href.length - 1) {
            href = href + "/"
        }
        return href;
    }
    var href = '';
    length = length == 0 ? $info.size() : length;
    var as = $menu.find('a');
    while (length > 0) {
        href = $info.eq(length - 1).attr('href');
        var url = getCurrUrl(href).toLowerCase();
        for (var i = 0; i < as.length; i++) {
            var href = as.eq(i).attr('href').toLowerCase() + '/';
            if (href.indexOf(url) > -1) {
                Selected(as.eq(i).parent('li'));
                length = -1;
                return;
            }
        }
        length = length - 1
    }
    if (length != -1) {
        if (typeof (MARK) != "undefined") {
            var _mark = MARK.toLowerCase();
            var lis = as.filter("[href$='/" + _mark + "/']").parents("li");
            if (lis.length) {
                Selected(lis);
            } else {
                Selected(as.eq(0).parent("li"));
            }
        } else {
            Selected(as.eq(0).parent("li"));
        }
    }
};
$(function () {
    var value = $('#seachkeywords').attr("defvalue");
    $('#sousuo').click(function () {
        var xz = $('#seachkeywords').val();
        if (xz == value) {
            xz = "";
        }
        window.location.href = '/Search/Index.aspx?objtype=product&kwd=' + xz;
    });
    SelectMenu();
    if (typeof (SID) != "undefined") {
        if (SID) {
            var div = $("div.leib2:first");
            if (SID.length < 10) {//一级分类

            }
            div.find("h3[sid='" + SID + "'],li[sid='" + SID + "']").addClass("cur");
        }
    }
    action();
    var key = "defvalue"
    $("div.form").find("input[" + key + "],textarea[" + key + "]").each(function () {
        var me = $(this);
        me.val(me.attr(key)).focus(function () {
            var me_ = $(this);
            if (this.value == me_.attr(key)) {
                this.value = '';
            }
        }).blur(function () {
            var me_ = $(this);
            if (this.value == "") {
                this.value = me_.attr(key);
            }
        });
        if (me.hasClass("keypress") && me.attr("button")) {
            me.keypress(function (event) {
                if (event.keyCode == '13') {
                    var button = $(this).attr("button");
                    if (button.indexOf('(') > 0) {//执行的方法
                        eval("(" + button + ")");
                    } else {
                        $(button).click();
                    }
                    return false;
                }
            });
        }
    })
    //谷歌下,会滚动很卡，是以为talk99有个空白的iframe，要移除掉
    //    var max = 100;
    //    var doyoo_share = $("#doyoo_share iframe");
    //    var _interval = setInterval(function () {
    //        doyoo_share = $("#doyoo_share iframe");
    //        if (max < 0 && doyoo_share.length) {
    //            if (doyoo_share.attr("src") == "about:blank") {
    //                doyoo_share.remove();
    //            }
    //            clearInterval(_interval);
    //        }
    //        max--;
    //    }, 10);
})

