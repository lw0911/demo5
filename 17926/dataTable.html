<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<!-- Bootstrap core CSS -->
		<link href="public/bootstrap.min.css" title="" rel="stylesheet" />
		<link rel="stylesheet" href="css/plugins/toastr/toastr.min.css" />
		<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
		<link href="public/animate.css" rel="stylesheet">
		<link rel="stylesheet" href="public/inspinia.css" />

		<!-- Data Tables -->
		<link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">
		<link href="css/plugins/dataTables/dataTables.responsive.css" rel="stylesheet">
		<link href="css/plugins/dataTables/dataTables.tableTools.min.css" rel="stylesheet">
		<link rel="stylesheet" href="css/dataTable.css" />
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		    <script src="../public/html5shiv.min.js"></script>
		    <script src="../public/respond.min.js"></script>
		<![endif]-->
		<title>销售订单</title>
	</head>

	<body>
		<div id="wrapper" class="container">
			<!--标编辑-->
			<div id="biaobj" class=" wrapper wrapper-content animated fadeInRight">
				<h3>月度打卡</h3>
				<div class="right_box" id="right_box" style="padding-top:0;">
					<form action="" class="form-horizontal">
						<div class="form-group for_box">
							<div class="col-lg-5 col-md-5 col-sm-5" style="padding:0;">
								<label for="" class="col-lg-2 col-md-2 col-sm-2 control-label">申请时间：</label>
								<div class="col-md-4 col-lg-4 col-sm-4">
									<div class="date input-append form_date ymd_date" id="addtimeCalendar" style="float:left;">
										<div class="input-group">
											<input style="height:34px;" class="form-control input-sm" type="text" name="bgtime" id="bgtime">
											<span class="add-on input-group-addon">
					                            <i class="fa fa-calendar" style="color:black;"></i>
					                        </span>
										</div>
									</div>
								</div>
								<span style="float: left;margin: 8px 10px 0;">—</span>
								<div class="col-md-4 col-lg-4 col-sm-4">
									<div class="date input-append form_date ymd_date" id="addtimeCalendar" style="float:left;">
										<div class="input-group">
											<input style="height:34px;" class="form-control input-sm" type="text" name="endtime" id="endtime">
											<span class="add-on input-group-addon"><i class="fa fa-calendar" style="color:black;"></i></span>
										</div>
									</div>
								</div>
							</div>
							<button style="width:82px;height:34px;margin-right: 10px;" type="button" class="col-lg-3 btn btn-success">搜索</button>
							<button style="width:82px;height:34px;margin-right: 10px;" type="button" class="col-lg-3 btn btn-success">添加</button>
						</div>
					</form>

					<!--表格部分-->
					<div class="ibox-content" style="border-top:none;padding-top:0;">
						<div class="row" style="margin:0;">
							<div class="col-sm-12" style="overflow-y: auto;padding:0;">
								<table class="table table-striped table-bordered table-hover " id="editable">
									<thead>
										<tr>
											<th>姓名</th>
											<th>部门</th>
											<th class="last">工号</th>
											<th>
												<p class="week">四</p>
												<p class="date">1</p>
											</th>
											<th>
												<p class="week">五</p>
												<p class="date">2</p>
											</th>
											<th>
												<p class="week">六</p>
												<p class="date">3</p>
											</th>
											<th>
												<p class="week">日</p>
												<p class="date">4</p>
											</th>
											<th>
												<p class="week">一</p>
												<p class="date">5</p>
											</th>
											<th>
												<p class="week">二</p>
												<p class="date">6</p>
											</th>
											<th>
												<p class="week">三</p>
												<p class="date">7</p>
											</th>
											<th>
												<p class="week">四</p>
												<p class="date">8</p>
											</th>
											<th>
												<p class="week">五</p>
												<p class="date">9</p>
											</th>

										</tr>
									</thead>
									<tbody>
										<tr>
											<td>
												<input type="checkbox" />
											</td>
											<td>
												<a class="name" href="javascript:void(0)">张三</a>
											</td>
											<td class="last"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td>
												<input type="checkbox" />
											</td>
											<td>
												<a class="name" href="javascript:void(0)">张三</a>
											</td>
											<td class="last"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td>
												<input type="checkbox" />
											</td>
											<td>
												<a class="name" href="javascript:void(0)">张三</a>
											</td>
											<td class="last"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
										<tr>
											<td>
												<input type="checkbox" />
											</td>
											<td>
												<a class="name" href="javascript:void(0)">张三</a>
											</td>
											<td class="last"></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
											<td></td>
										</tr>
									</tbody>
								</table>
							</div>

						</div>
					</div>
				</div>
			</div>

			<script src="public/jquery-1.11.3.js"></script>
			<script src="public/bootstrap.min.js" type="text/javascript"></script>
			<script src="js/plugins/lhgdialog/lhgdialog.js"></script>
			<!-- 弹出警示框 -->
			<script src="js/plugins/toastr/toastr.min.js"></script>
			<!-- 弹出确认框 -->
			<script src="public/artDialog4.1.7/artDialog.js?skin=blue"></script>
			<script src="public/artDialog4.1.7/plugins/iframeTools.js"></script>

			<!-- Data Tables -->
			<script src="js/plugins/dataTables/jquery.dataTables.js"></script>
			<script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>
			<script src="js/plugins/dataTables/dataTables.responsive.js"></script>
			<script src="js/plugins/dataTables/dataTables.tableTools.min.js"></script>
			<!-- 时间控件样式 -->
			<script src="js/plugins/datetimepicker/bootstrap-datetimepicker.min.js"></script>
			<script src="js/plugins/datetimepicker/bootstrap-datetimepicker-update.min.js"></script>
			<script src="js/plugins/datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>

			<script>
				var trs;
				$(function() {
					/*选择年月日*/
					$('.ymd_date').datetimepicker({　
						minView: "month",
						format: "yyyy-mm-dd",
						language: 'zh-CN',
						autoclose: true,
						pickerPosition: "bottom-left",
					}).on('changeDate', function(ev) {
						var stTime = $('#bgtime').val();
						var endTime = $('#endtime').val();
						var stdt = new Date(stTime.replace("-", "/"));
						var etdt = new Date(endTime.replace("-", "/"));
						if(stTime !== "" && endTime !== "") {
							if(stdt > etdt) {
								alert("结束时间不能在开始时间之前！");
								$('#endtime').val('');
							} else {
								if(DateDiff(stTime, endTime) > '30') {
									alert("日期间隔不能大于30天！");
									$('#endtime').val('');
								} else {
									alert('两个日期间隔为：' + DateDiff(stTime, endTime) + '天'); //得到两个日期的间隔天数
									var startTime = getDate(stTime);
									var endTime = getDate(endTime);
									while((endTime.getTime() - startTime.getTime()) >= 0) {
										var year = startTime.getFullYear();
										var month = startTime.getMonth().toString().length == 1 ? "0" + startTime.getMonth().toString() : startTime.getMonth();
										var day = startTime.getDate().toString().length == 1 ? "0" + startTime.getDate() : startTime.getDate();
										console.log(year + "-" + month + "-" + day);
										startTime.setDate(startTime.getDate() + 1);
									}

								}
							}
						}

					});
					/******************/
					/*清楚第一行class名为last的th后面所有的兄弟元素*/
					$('#editable thead tr th.last').nextAll().remove();
					var str;
					for(var k = 1; k <= 30; k++) {
						str += '<th><p class="week"></p><p class="date">' + k + '</p></th>';
					}
					$('#editable thead tr th.last').after(str);

					var trs = $('#editable tbody tr');
					for(var j = 0; j < trs.length; j++) {
						$(trs[j]).find('td.last').nextAll().remove();
						for(var z = 1; z <= 30; z++) {
							var str2 = "<td></td>";
							$(trs[j]).find('td.last').after(str2);
						}

					}
					var span = '<span>8:30上班打卡，下班未打卡</span>';
					$('#editable tbody tr:eq(0)').find('td.last').next().append(span);
					/********************/
					$('#editable').dataTable({
						"bPaginate": true, //翻页功能
						"bLengthChange": false, //改变每页显示数据数量
						"bFilter": false, //过滤功能
						"bSort": false, //排序功能
						"bInfo": true, //页脚信息
						"bAutoWidth": true, //自动宽度
						"scrollY": "120px",
						"sEmptyTable":"",
						"scrollX": true,
						"fixedColumns": {
							"leftColumns": 3
						},
						"oLanguage": {
							"sLengthMenu": "每页显示 _MENU_ 条记录",
							"sZeroRecords": "对不起，查询不到任何相关数据",
							"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
							"sInfoEmtpy": "找不到相关数据",
							"sInfoFiltered": "数据表中共为 _MAX_ 条记录)",
							"sProcessing": "正在加载中...",
							"sSearch": "搜索",
							"sUrl": "", //多语言配置文件，可将oLanguage的设置放在一个txt文件中，例：Javascript/datatable/dtCH.txt
							"oPaginate": {
								"sFirst": "第一页",
								"sPrevious": " 上一页 ",
								"sNext": " 下一页 ",
								"sLast": " 最后一页 "
							}
						}, //多语言配置
					});
					trs = $('.DTFC_LeftBodyLiner table tbody tr');
					for(var i = 0; i < trs.length; i++) {
						$(trs[i]).find('td:eq(1)').find('a').click(function() {
							var expanded = false;
							if(expanded) {
								$('#ifr').animate({
									right: '-780'
								}, 500);
							} else {
								$('#ifr').animate({
									right: '0px'
								}, 500);
								$("#ifr").contents().find(".form-close-icon").click(function() {
									$('#ifr').animate({
										right: '-780'
									}, 500);
								});

							}

							expanded = !expanded;
						})

					}
				});

				function DateDiff(sDate1, sDate2) { //sDate1和sDate2是yyyy-MM-dd格式
					var aDate, oDate1, oDate2, iDays;
					aDate = sDate1.split("-");
					oDate1 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0]); //转换为yyyy-MM-dd格式
					aDate = sDate2.split("-");
					oDate2 = new Date(aDate[1] + '-' + aDate[2] + '-' + aDate[0]);
					iDays = parseInt(Math.abs(oDate1 - oDate2) / 1000 / 60 / 60 / 24); //把相差的毫秒数转换为天数
					return iDays; //返回相差天数

				}

				function getDate(datestr) {
					var temp = datestr.split("-");
					var date = new Date(temp[0], temp[1], temp[2]);
					return date;
				}

			</script>
	</body>

</html>